# OpenClaw + Lark（飞书）消息自动收集、分类整理与审核方案可行性调研

> **版本：** v1.0
> **日期：** 2026-02-11
> **受众：** 技术开发者（有 OpenClaw 基础认知）
> **状态：** 初稿

---

## 1. 执行摘要

1. **技术上完全可行，但需要组合多个组件实现。** OpenClaw 官方飞书插件 + Cron Jobs + Multi-Agent Routing + Bitable 工具的组合，可以覆盖"自动收集消息 -> AI 分类整理 -> 人工审核确认"的完整链路 [1][2][3]。

2. **"别人给 Bot 发消息"和"别人 @mention 我（人类用户）"是两个完全不同的技术问题。** 前者通过飞书 Bot 事件订阅即可轻松实现；后者需要 `im:message.group_msg` 敏感权限读取群聊全量消息后过滤，或者依赖转发/抄送机制间接实现 [4][5]。

3. **OpenClaw 的邮件 triage 场景已经非常成熟，飞书消息 triage 可以复用相同模式。** Danish Dhamani 演示了批量分类数百封邮件并节省 4 小时的案例 [6]，社区已有 Gmail Rollup（每日汇总）和 Inbox Cleanup 等成熟技能，飞书消息可按相同模式构建。

4. **审核工作流是最大的缺口。** OpenClaw 目前没有内置的"消息审核队列" UI，其 approvals 系统是针对 exec 权限控制的，而非消息审批流 [7]。推荐使用飞书多维表格（Bitable）作为审核看板，通过 `@m1heng-clawd/feishu` 插件的 Bitable 工具实现 AI 自动写入 + 人工审核确认。

5. **推荐采用"收集-分类-审核"三阶段架构。** 第一阶段：飞书事件订阅自动收集消息；第二阶段：AI Agent 按预设规则自动分类、摘要、草拟回复；第三阶段：结果写入 Bitable 审核看板，用户批量审核确认。

6. **社区插件 `@m1heng-clawd/feishu` 是关键拼图。** 其 v0.1.7 新增的 6 个 Bitable 多维表格操作工具 [3]，使得 AI 可以直接在飞书生态内创建和管理审核看板，无需额外开发 Web UI。

7. **预计实现周期 2-4 周，分三期交付。** 第一期（1 周）：Bot 基础消息收集 + 简单分类；第二期（1 周）：智能分类规则 + Bitable 审核看板；第三期（1-2 周）：自动回复草稿 + 异常升级 + 定时汇总。

8. **核心限制：群聊中收集"@mention 人类用户"的消息需要申请敏感权限，审批流程可能需要 1-2 周。** 如果仅收集"发给 Bot 的私聊"和"@mention Bot 的群聊消息"，则无需敏感权限，可快速上线 [4]。

---

## 2. 研究问题与范围

### 核心问题

用户希望实现：**当别人在飞书给我发消息或 @mention 我时，OpenClaw 自动收集整理这些消息，分门别类处理好，我只需要审核确认即可，不需要持续关注。只有 AI 处理不好的模糊情况才需要手动处理。**

将此需求拆解为四个技术子问题：

| # | 子问题 | 关键约束 |
|---|--------|---------|
| Q1 | 飞书消息能否被自动收集？ | 区分私聊 vs 群聊、@Bot vs @人类 |
| Q2 | OpenClaw 能否自动分类整理这些消息？ | 准确率、分类维度、上下文理解 |
| Q3 | 能否构建审核工作流？ | 审核 UI、批量操作、确认后自动执行 |
| Q4 | 整体方案的可行性和实现成本？ | 开发周期、运维成本、技术风险 |

### 研究范围

| 维度 | 包含 | 排除 |
|------|------|------|
| 飞书 API | 事件订阅、Bot 消息、Bitable API | 飞书审批流、人事 API |
| OpenClaw 能力 | 飞书插件、Cron Jobs、Multi-Agent、Skills | 基础安装部署（已有报告覆盖 [1]） |
| 消息场景 | 私聊、群聊 @mention、群聊全量 | 飞书日历事件、飞书文档评论 |
| 审核方案 | Bitable 看板、消息卡片确认 | 自建 Web UI、第三方工单系统 |

---

## 3. 技术可行性分析

### 3.1 飞书事件订阅能力评估

飞书开放平台提供了完整的消息事件订阅能力，是整个方案的数据入口层。

#### 权限与事件模型

| 权限标识 | 能力 | 敏感级别 | 审批难度 |
|---------|------|---------|---------|
| `im:message.p2p_msg:readonly` | 读取发给 Bot 的私聊消息 | 普通 | 低，自动审批 |
| `im:message.group_at_msg:readonly` | 接收群聊中 @mention Bot 的消息 | 普通 | 低，自动审批 |
| `im:message.group_msg` | 读取群聊所有消息 | **Sensitive** | **高，需人工审核** |

核心事件类型 `im.message.receive_v1` 在 Bot 接收到消息时触发，事件负载包含发送者 ID、消息内容、消息类型、所在群聊 ID 等完整上下文信息 [4]。

#### 两种事件接收模式

| 对比项 | WebSocket 长连接 | Webhook 回调 |
|--------|----------------|-------------|
| 公网 IP 要求 | 不需要 | 需要 |
| 实时性 | 高（持久连接） | 高（HTTP POST） |
| 部署复杂度 | 低 | 中（需反向代理） |
| OpenClaw 支持 | 官方默认模式 [1] | 社区插件支持 |
| 推荐场景 | 个人/小团队 | 企业高可用 |

**关键发现：** OpenClaw 官方飞书插件默认使用 WebSocket 长连接模式，无需公网 IP 即可接收飞书事件 [1]，这大幅降低了部署门槛。

#### "@mention 人类用户"的消息获取问题

这是整个方案中最关键的技术约束点。当别人在群聊中 @mention 的是**人类用户**（而非 Bot）时，Bot 默认**无法收到**这条消息。要获取这类消息，存在三种路径：

**路径 A：申请 `im:message.group_msg` 敏感权限**

```
群聊消息流 --> 飞书开放平台（全量推送）--> Bot 接收 --> 过滤含 @mention 目标用户的消息
```

- 优点：完整获取群聊全量消息，可精确过滤
- 缺点：需要飞书管理员审批敏感权限，审批周期 1-2 周
- 适用：企业内部部署，有管理员权限

**路径 B：消息转发/抄送机制**

```
群聊 @mention 人类用户 --> 人类用户手动/自动转发给 Bot --> Bot 处理
```

- 优点：无需敏感权限
- 缺点：依赖人工转发或飞书自动化规则，不完全自动化
- 适用：过渡方案

**路径 C：双身份共存模式**

```
用户在群聊中 @mention Bot（而非人类自己）--> Bot 代为收集和处理
```

- 优点：仅需普通权限，完全自动化
- 缺点：需要改变用户习惯（@Bot 而非 @人类）
- 适用：团队内部推广后的标准化流程

**推荐策略：** 优先使用路径 C（最低门槛），同时申请路径 A（最终方案）。路径 B 作为过渡备选。

### 3.2 OpenClaw 消息处理能力评估

OpenClaw 提供了丰富的自动化原语，可以满足消息收集、处理和响应的全部需求。

#### 核心能力矩阵

| 能力 | 说明 | 对应需求 |
|------|------|---------|
| **Cron Jobs** [2] | 定时任务系统，支持标准 cron 表达式 | 定时汇总消息、生成日报 |
| **Heartbeat** [2] | 心跳机制，周期性检查和主动推送 | 定期检查待审核项、提醒用户 |
| **Multi-Agent Routing** [2] | 多代理路由，不同 Agent 处理不同类型消息 | 工作消息 vs 生活消息分流 |
| **Skills 系统** [2] | 2999+ 社区技能，可自定义 | 分类逻辑、摘要生成、回复草拟 |
| **持久记忆** [2] | 跨会话记忆能力 | 记住用户偏好、历史分类规则 |
| **Lobster 工作流引擎** [2] | 复杂自动化管道 | 串联收集-分类-审核完整流程 |

#### 飞书插件能力

**官方插件 `@openclaw/feishu`** [1]：

```yaml
channels:
  feishu:
    app_id: "cli_xxxxxxxxxxxx"
    app_secret: "your_app_secret"
    features:
      streaming: true
      group_chat: true
      mention_only: true    # 群聊中仅 @bot 时响应
      media:
        image: true
        file: true
```

**社区插件 `@m1heng-clawd/feishu`** [3]（2,947 星标）：

在官方插件基础上提供飞书深度集成能力：
- 飞书文档读写
- Wiki 集成
- **多维表格（Bitable）工具**（v0.1.7 新增 6 个操作工具）
- Drive 文件管理
- 动态 Agent 创建

Bitable 工具是实现审核看板的关键能力，包括：创建表格、读取记录、写入记录、更新记录、删除记录、查询筛选。

### 3.3 自动分类整理的可行性

OpenClaw 的邮件 triage 场景已经非常成熟，为飞书消息分类提供了可直接复用的模式参考。

#### 邮件 triage 的已验证能力 [6]

| 能力 | 说明 | 飞书消息场景映射 |
|------|------|---------------|
| 重要性排序 | 区分紧急 vs 普通 | 消息优先级判定 |
| 智能过滤 | 去除营销、通知类邮件 | 过滤系统通知、群聊噪音 |
| 内容摘要 | 提取邮件核心内容 | 长消息/多条消息摘要 |
| 草拟回复 | 根据上下文自动草拟回复 | 草拟飞书消息回复 |
| 批量处理 | 一次性处理数百封邮件 | 批量处理积压消息 |
| 每日汇总 | Gmail Rollup 技能 | 飞书消息日报 |

#### 飞书消息分类维度设计

基于常见企业通讯场景，建议采用以下分类体系：

```
一级分类（按紧急程度）:
├── P0 紧急：需要立即回复（含"紧急"、"urgent"、deadline 临近）
├── P1 重要：需要当天回复（工作任务、会议安排、审批请求）
├── P2 普通：可延迟回复（日常沟通、信息同步）
└── P3 低优先级：可忽略或批量处理（群聊闲聊、系统通知）

二级分类（按类型）:
├── 任务指派：别人分配给我的工作任务
├── 问题咨询：别人向我提问/请教
├── 会议通知：会议邀请、时间变更
├── 审批请求：需要我审批/确认的事项
├── 信息同步：FYI 类消息，不需回复
├── 社交寒暄：问候、闲聊
└── 其他：AI 无法准确分类的消息
```

#### 分类实现方式

```yaml
# OpenClaw Agent 分类 System Prompt 示例
agents:
  feishu_triage:
    name: "飞书消息分拣员"
    model: "claude-sonnet-4"    # 分类任务用 Sonnet 即可
    system_prompt: |
      你是一个飞书消息分类助手。你的任务是对收到的飞书消息进行分类和摘要。

      分类规则：
      1. P0 紧急 - 包含"紧急"、"ASAP"、"urgent"，或涉及生产事故、客户投诉
      2. P1 重要 - 工作任务分配、会议安排、审批请求、有明确 deadline
      3. P2 普通 - 日常工作沟通、信息同步、不需要立即行动
      4. P3 低优先级 - 群聊闲聊、系统通知、营销消息

      对每条消息输出：
      - 优先级：P0/P1/P2/P3
      - 类型：任务指派/问题咨询/会议通知/审批请求/信息同步/社交寒暄/其他
      - 摘要：一句话概括消息核心内容
      - 建议操作：需要回复/转发/归档/忽略
      - 草拟回复（如需回复）：根据上下文草拟回复内容
    tools:
      - bitable_write    # 写入审核看板
      - feishu_reply     # 自动回复（经审核后）
```

#### 分类准确率预期

基于 OpenClaw 邮件 triage 场景的社区反馈 [6]，结合 Claude Sonnet 的文本理解能力：

| 分类维度 | 预期准确率 | 说明 |
|---------|----------|------|
| 紧急程度 | 85-90% | 关键词匹配 + 上下文理解 |
| 消息类型 | 80-85% | 需要理解语义意图 |
| 需要回复判断 | 90-95% | 明确的 @mention + 问句模式 |
| 草拟回复质量 | 70-80% | 需人工审核调整 |

> **注意：** 上述准确率为基于邮件场景类比推算的预期值，飞书消息的实际分类准确率需通过实际部署验证。中文消息的语义理解准确率可能略低于英文。

### 3.4 审核工作流的可行性

这是整个方案中**需要最多创造性设计**的环节。

#### 现状：OpenClaw 没有内置消息审核队列

OpenClaw 的 approvals 系统 [7] 是针对 `exec` 权限的安全控制机制——当 Agent 需要执行 Shell 命令或文件操作时请求用户批准。这不是一个通用的消息审核/审批队列。

因此，"消息审核工作流"需要通过以下方案之一实现。

#### 方案对比

| 方案 | 技术复杂度 | 用户体验 | 推荐度 |
|------|----------|---------|-------|
| A. 飞书消息卡片确认 | 低 | 中（在飞书内操作） | 适合简单场景 |
| B. Bitable 审核看板 | 中 | 高（可视化、可批量操作） | **推荐** |
| C. 自建 Web UI | 高 | 极高（完全定制） | 过度工程化 |
| D. 飞书 Bot 对话式审核 | 低 | 低（逐条确认，效率低） | 不推荐 |

**推荐方案 B 的理由：**

1. `@m1heng-clawd/feishu` 的 Bitable 工具已提供完整的表格 CRUD 能力 [3]，无需额外开发
2. 飞书多维表格本身支持视图切换（看板视图、表格视图）、筛选、排序、批量操作
3. 用户可以在飞书 App 内直接操作，无需切换应用
4. 天然支持多人协作，未来可扩展为团队审核流程

---

## 4. 架构方案设计

### 4.1 方案 A：Bot 直接响应模式（简单）

**适用场景：** 快速验证、个人轻量使用

```
┌─────────────────────────────────────────────────┐
│                    飞书                           │
│                                                   │
│  用户 A ──私聊──> 飞书 Bot ──> OpenClaw Agent    │
│  用户 B ──@Bot──> 飞书 Bot ──> OpenClaw Agent    │
│                                    │              │
│                                    v              │
│                            AI 直接回复消息         │
└─────────────────────────────────────────────────┘
```

**config.yaml 配置：**

```yaml
channels:
  feishu:
    app_id: "cli_xxxxxxxxxxxx"
    app_secret: "your_app_secret"
    features:
      streaming: true
      group_chat: true
      mention_only: true

agents:
  default:
    name: "飞书助手"
    model: "claude-sonnet-4"
    system_prompt: |
      你是我的飞书消息助手。当收到消息时：
      1. 判断消息的紧急程度和类型
      2. 对于简单问题（问候、FYI 通知），直接简短回复
      3. 对于复杂问题，先回复"收到，正在处理中"，然后生成详细回复
      4. 对于需要我本人确认的事项，回复"已转达，稍后回复"
```

**优点：**
- 配置简单，15 分钟上线
- 无需额外组件
- 适合测试验证

**缺点：**
- 没有审核环节，AI 直接回复可能出错
- 没有分类归档，消息处理后不留痕
- 不适合需要精确控制的场景

### 4.2 方案 B：收集-分类-审核三阶段模式（推荐）

**适用场景：** 生产级使用，需要审核控制

```
┌──────────────────────────────────────────────────────────────────┐
│                         整体架构                                  │
│                                                                    │
│  ┌─────────┐     ┌──────────────┐     ┌──────────────┐           │
│  │ 阶段一   │     │   阶段二      │     │   阶段三      │           │
│  │ 收集层   │────>│   处理层      │────>│   审核层      │           │
│  └─────────┘     └──────────────┘     └──────────────┘           │
│                                                                    │
│  飞书事件订阅       AI Agent            飞书消息卡片                │
│  ├─私聊消息         ├─分类（P0-P3）     ├─P0: 立即推送审核卡片     │
│  ├─@Bot 群聊消息    ├─摘要提取          ├─P1: 汇入待审核队列       │
│  └─全量群聊消息*    ├─意图识别          ├─P2/P3: 每日汇总          │
│    (*需敏感权限)    ├─草拟回复          └─审核后触发自动操作        │
│                     └─写入暂存区                                   │
└──────────────────────────────────────────────────────────────────┘
```

**config.yaml 配置：**

```yaml
channels:
  feishu:
    plugin: "@openclaw/feishu"
    app_id: "cli_xxxxxxxxxxxx"
    app_secret: "your_app_secret"
    features:
      streaming: true
      group_chat: true
      mention_only: false    # 接收全量消息（需敏感权限）

# 多代理路由配置
agents:
  # 消息收集与分类 Agent
  triage_agent:
    name: "消息分拣员"
    model: "claude-sonnet-4"
    system_prompt: |
      你是飞书消息自动分拣系统。你的任务：

      1. 接收飞书消息后，判断是否与目标用户相关（@mention、私聊、任务指派）
      2. 对相关消息进行分类：
         - P0 紧急：包含"紧急"/"ASAP"/生产事故/客户投诉
         - P1 重要：任务分配/会议安排/审批请求/有 deadline
         - P2 普通：日常沟通/信息同步
         - P3 低优先级：闲聊/系统通知
      3. 提取摘要（一句话概括）
      4. 判断建议操作：需要回复/需要转发/仅存档/可忽略
      5. 如需回复，草拟回复内容
      6. 将结果写入 Bitable 审核看板

      特殊规则：
      - P0 消息立即通过飞书卡片推送通知
      - 来自[老板姓名]的消息自动升级一个优先级
      - 重复内容（如群消息轰炸）合并为一条记录
    tools:
      - bitable_write
      - feishu_send_card

  # 自动回复 Agent（审核通过后触发）
  reply_agent:
    name: "回复执行员"
    model: "claude-haiku-3.5"    # 简单回复用 Haiku 节省成本
    system_prompt: |
      你负责执行已审核通过的飞书消息回复。
      从 Bitable 审核看板中读取状态为"已审核-同意"的记录，
      按照草拟回复内容发送飞书消息。
      发送后更新记录状态为"已回复"。

# 定时任务
cron_jobs:
  # 每日消息汇总
  daily_digest:
    schedule: "0 9 * * *"    # 每天早上 9:00
    agent: "triage_agent"
    prompt: |
      生成昨日飞书消息汇总报告：
      1. 按优先级统计消息数量
      2. 列出所有 P0/P1 消息及处理状态
      3. 高亮未处理的消息
      4. 通过飞书卡片推送给我

  # 待审核提醒
  pending_reminder:
    schedule: "0 */2 * * *"  # 每 2 小时
    agent: "triage_agent"
    prompt: |
      检查 Bitable 审核看板中状态为"待审核"的记录：
      - 如果有 P0/P1 级别的待审核项，立即推送提醒
      - 如果待审核总数超过 10 条，推送汇总提醒
```

**Bitable 审核看板结构设计：**

| 字段名 | 字段类型 | 说明 |
|--------|---------|------|
| 消息ID | 文本 | 飞书消息唯一标识 |
| 时间 | 日期时间 | 消息发送时间 |
| 发送者 | 文本 | 发送人姓名 |
| 来源 | 单选 | 私聊 / 群聊名称 |
| 原始内容 | 多行文本 | 消息原文 |
| 优先级 | 单选 | P0 紧急 / P1 重要 / P2 普通 / P3 低 |
| 消息类型 | 单选 | 任务指派 / 问题咨询 / 会议通知 / 审批请求 / 信息同步 / 其他 |
| AI 摘要 | 文本 | AI 生成的一句话摘要 |
| 建议操作 | 单选 | 需要回复 / 需要转发 / 仅存档 / 可忽略 |
| 草拟回复 | 多行文本 | AI 草拟的回复内容 |
| 审核状态 | 单选 | 待审核 / 已审核-同意 / 已审核-修改 / 已忽略 |
| 实际回复 | 多行文本 | 修改后的最终回复（如有修改） |
| 处理时间 | 日期时间 | 审核/处理完成时间 |

**用户操作流程：**

```
1. 消息自动收集和分类（无需人工介入）
   ↓
2. P0 紧急消息 → 飞书卡片立即推送 → 用户在卡片上点击"同意回复"或"修改后回复"
   ↓
3. P1/P2 消息 → 写入 Bitable 审核看板 → 用户打开看板批量审核
   ↓
4. P3 消息 → 自动归档 → 每日汇总报告中列出
   ↓
5. 审核通过 → Reply Agent 自动发送回复
   ↓
6. 每日早间汇总 → 推送昨日处理报告
```

### 4.3 方案 C：Bitable 审核看板模式（高级）

**适用场景：** 团队协作、多人审核分工

方案 C 是方案 B 的增强版，增加以下能力：

```
┌──────────────────────────────────────────────────────────────────────┐
│                      高级 Bitable 审核看板架构                        │
│                                                                        │
│  ┌──────────┐    ┌──────────┐    ┌──────────────────────────┐        │
│  │ 收集层    │───>│ 处理层    │───>│      Bitable 审核看板     │        │
│  │          │    │          │    │                            │        │
│  │ 飞书事件  │    │ Triage   │    │ ┌────────────────────┐   │        │
│  │ 订阅     │    │ Agent    │    │ │   看板视图           │   │        │
│  └──────────┘    └──────────┘    │ │ ┌────┐┌────┐┌────┐ │   │        │
│                                   │ │ │待审 ││审核 ││已完 │ │   │        │
│  ┌──────────┐                    │ │ │核  ││中  ││成  │ │   │        │
│  │ Heartbeat│───定期检查────────>│ │ │    ││    ││    │ │   │        │
│  │ 系统     │                    │ │ └────┘└────┘└────┘ │   │        │
│  └──────────┘                    │ └────────────────────┘   │        │
│                                   │                            │        │
│  ┌──────────┐                    │ ┌────────────────────┐   │        │
│  │ Cron Job │───每日汇总────────>│ │   仪表盘视图        │   │        │
│  │ 系统     │                    │ │ 今日:12条 已处理:8  │   │        │
│  └──────────┘                    │ │ P0:2 P1:5 P2:3 P3:2│   │        │
│                                   │ └────────────────────┘   │        │
│  ┌──────────┐                    └──────────────────────────┘        │
│  │ Reply    │<───审核通过后触发                                       │
│  │ Agent    │───发送回复───> 飞书消息                                  │
│  └──────────┘                                                         │
└──────────────────────────────────────────────────────────────────────┘
```

**增强能力：**

1. **看板视图**：利用飞书多维表格的看板视图，将消息按审核状态分列展示，拖拽即可改变状态
2. **仪表盘**：统计今日/本周消息量、分类分布、处理效率等指标
3. **多人协作**：不同审核人负责不同类型的消息（如：技术消息由 Tech Lead 审核，商务消息由 BD 审核）
4. **自动化规则**：飞书多维表格自动化——当记录状态变为"已审核-同意"时自动触发 Webhook，通知 Reply Agent 执行回复
5. **历史归档**：所有消息记录留痕，可按时间、发送者、类型等维度回溯检索

**额外配置（在方案 B 基础上增加）：**

```yaml
# Bitable 自动化集成
integrations:
  bitable_webhook:
    # 当 Bitable 记录状态变更时触发
    trigger: "record_status_change"
    table_id: "tblXXXXXXXX"
    field: "审核状态"
    value: "已审核-同意"
    action:
      agent: "reply_agent"
      prompt: "读取该记录的草拟回复，发送给对应的飞书用户"

# 多人审核路由
routing:
  rules:
    - condition: "消息类型 == '任务指派' AND 来源 contains '技术'"
      reviewer: "tech_lead_user_id"
    - condition: "消息类型 == '审批请求'"
      reviewer: "manager_user_id"
    - default:
      reviewer: "owner_user_id"
```

### 三种方案对比总结

| 维度 | 方案 A：直接响应 | 方案 B：三阶段（推荐） | 方案 C：Bitable 看板 |
|------|:---:|:---:|:---:|
| 实现复杂度 | 低（1-2 天） | 中（1-2 周） | 高（2-4 周） |
| 审核控制 | 无 | 有（逐条/批量） | 有（完整看板） |
| 错误容忍度 | 低（直接回复） | 高（审核后回复） | 高（审核后回复） |
| 消息归档 | 无 | 有（Bitable 记录） | 有（完整历史） |
| 团队协作 | 不支持 | 基础支持 | 完整支持 |
| 成本 | $10-20/月 | $20-50/月 | $30-80/月 |
| 推荐场景 | 快速验证/个人 | **个人生产使用** | 团队协作 |

---

## 5. 实现路径

推荐方案 B 的具体实施步骤，分三期交付。

### 第一期：基础消息收集与简单分类（1 周）

**目标：** Bot 能接收消息并进行基础分类

**步骤：**

1. **飞书开放平台配置**（2 小时）
   - 创建企业自建应用，开启 Bot 能力
   - 申请权限：`im:message.p2p_msg:readonly`、`im:message.group_at_msg:readonly`
   - 获取 App ID 和 App Secret
   - （可选）同步申请 `im:message.group_msg` 敏感权限

2. **OpenClaw 飞书插件配置**（1 小时）
   ```bash
   # 安装官方插件（如未内置）
   openclaw plugins install @openclaw/feishu

   # 交互式配置
   openclaw channels add
   # 选择 feishu -> 输入 App ID -> 输入 App Secret
   ```

3. **配置 Triage Agent**（2 小时）
   - 编写分类 System Prompt
   - 定义分类规则和输出格式
   - 测试分类准确率

4. **基础验证**（2 小时）
   - 在飞书中给 Bot 发送测试消息
   - 验证消息接收和分类是否正常
   - 调优分类规则

**第一期交付物：** Bot 可接收私聊和 @mention 消息，返回分类结果和摘要。

### 第二期：Bitable 审核看板 + 智能分类（1 周）

**目标：** 消息自动写入审核看板，用户可批量审核

**步骤：**

1. **安装社区插件**（30 分钟）
   ```bash
   openclaw plugins install @m1heng-clawd/feishu
   ```
   在飞书开放平台追加权限：`bitable:bitable`

2. **创建 Bitable 审核看板**（1 小时）
   - 在飞书多维表格中创建"消息审核看板"
   - 配置字段（参见 4.2 节表格设计）
   - 配置看板视图（按审核状态分列）

3. **对接 Bitable 工具**（3 小时）
   - 配置 Triage Agent 的 Bitable 写入工具
   - 测试 AI 自动写入审核看板
   - 验证数据格式和字段映射

4. **配置 P0 紧急推送**（2 小时）
   - P0 消息通过飞书卡片立即推送
   - 卡片包含消息摘要和快捷操作按钮

5. **配置定时汇总**（2 小时）
   - Cron Job：每日早 9:00 推送消息汇总
   - Heartbeat：每 2 小时检查待审核项

**第二期交付物：** 完整的收集-分类-审核链路，用户可在 Bitable 中审核消息。

### 第三期：自动回复 + 异常处理 + 优化（1-2 周）

**目标：** 审核后自动执行回复，处理边缘情况

**步骤：**

1. **配置 Reply Agent**（3 小时）
   - 审核通过后自动发送飞书回复
   - 支持"修改后回复"（用户在 Bitable 中修改草拟内容）

2. **异常升级机制**（2 小时）
   - AI 置信度低的消息标记为"需人工判断"
   - 超过 4 小时未审核的 P0/P1 消息自动升级提醒

3. **分类规则迭代**（持续）
   - 基于审核反馈优化分类规则
   - 利用持久记忆学习用户偏好
   - 添加发送者白名单/黑名单

4. **成本优化**（2 小时）
   - P3 消息用 Haiku 模型处理
   - P0/P1 消息用 Sonnet 模型处理
   - 批量合并相似消息减少 API 调用

**第三期交付物：** 完整的自动化消息处理系统，包含自动回复和异常升级。

---

## 6. 风险与局限

### 技术风险

| 风险 | 影响 | 概率 | 缓解措施 |
|------|------|------|---------|
| `im:message.group_msg` 敏感权限审批被拒 | 无法收集"@mention 人类用户"的群聊消息 | 中 | 采用路径 C（引导用户 @Bot），或申请时提供充分的使用场景说明 |
| AI 分类准确率不达预期 | 大量消息需要人工重新分类 | 中 | 先用小范围测试调优 Prompt，持续迭代分类规则 |
| AI 草拟回复不当 | 审核后回复仍可能有措辞问题 | 低-中 | 重要消息必须人工审核修改，P3 消息可放宽 |
| WebSocket 连接断线 | 消息丢失 | 低 | OpenClaw 官方插件内置重连逻辑 [1]；配置 Heartbeat 定期检查连接状态 |
| Bitable API 调用频率限制 | 高峰期写入失败 | 低 | 实现写入队列和重试机制；飞书 Bitable API 限制为 100 次/秒 [4]，个人使用绑绑有余 |
| 消息量暴增（如被拉入大群） | API 成本飙升 | 中 | 配置消息过滤规则，设置 API 预算上限 |

### 功能局限

| 局限 | 说明 | 影响程度 |
|------|------|---------|
| **无法处理图片/语音消息内容** | 当前分类仅基于文本内容；图片/语音消息只能记录"收到图片/语音"，无法分析内容 | 中——可通过 Claude 多模态能力扩展图片理解 |
| **无原生审核队列 UI** | OpenClaw 不提供消息审核界面，需借助 Bitable [7] | 中——Bitable 是合理替代方案 |
| **群聊上下文受限** | 如果不申请全量消息权限，Bot 只能看到 @mention 它的消息，缺少上下文 | 高——可能导致分类和回复质量下降 |
| **实时性延迟** | 从消息收集到写入 Bitable 有 1-3 秒延迟 | 低——对于审核场景完全可接受 |
| **不支持离线场景** | OpenClaw 需要持续运行，断电/重启期间消息会丢失 | 中——使用 Docker + 自动重启策略 |

### 安全风险

| 风险 | 缓解措施 |
|------|---------|
| Bot 拥有消息读取权限，可能被 Prompt Injection 攻击 | 严格定义 Agent 权限边界；不授予 exec 权限 |
| API Key 泄露 | 使用环境变量管理密钥；不将 config.yaml 提交到公开仓库 |
| 飞书消息含敏感信息 | Bitable 审核看板设置访问权限；定期清理历史记录 |

---

## 7. 建议

### 立即行动（本周）

1. **在飞书开放平台创建自建应用**，申请基础权限（`im:message.p2p_msg:readonly` + `im:message.group_at_msg:readonly`），同时提交 `im:message.group_msg` 敏感权限申请（审批需要时间，越早提交越好）。

2. **安装 OpenClaw 官方飞书插件**并完成基础消息收发验证，确认 Bot 能正常接收消息。

3. **使用方案 A（直接响应模式）做快速验证**，测试 AI 对飞书消息的分类效果和回复质量，积累调优经验。

### 短期（1-2 周）

4. **安装 `@m1heng-clawd/feishu` 社区插件**，配置 Bitable 工具，搭建审核看板。

5. **按方案 B 部署三阶段架构**，配置 Triage Agent + Reply Agent + Cron Jobs。

6. **建立分类规则基线**，先处理 1 周的消息，统计分类准确率，迭代优化 Prompt。

### 中期（1 个月）

7. **根据审核反馈持续优化**，利用 OpenClaw 持久记忆记录用户偏好和修正历史。

8. **评估是否需要升级到方案 C**（Bitable 完整看板），取决于消息量和团队协作需求。

9. **考虑增加功能**：图片消息理解（Claude 多模态）、语音转文字、自动日程创建等。

### 成本预估

| 使用强度 | 日均消息量 | 月均 API 成本 | 推荐模型组合 |
|---------|----------|-------------|------------|
| 轻度 | 20-50 条 | $10-20 | Sonnet（分类）+ Haiku（回复） |
| 中度 | 50-200 条 | $20-50 | Sonnet（分类+回复） |
| 重度 | 200+ 条 | $50-100 | Sonnet（核心）+ Haiku（P3 消息） |

> **成本控制建议：** P3 低优先级消息使用 Haiku 模型处理（$0.25/MTok），P0/P1 消息使用 Sonnet（$3/MTok）。设置 Anthropic Console 月度预算上限 $50 作为安全阈值。

---

## 8. 附录：证据表

| 编号 | 来源类型 | 标题/描述 | 关键数据点 | 质量 |
|------|----------|-----------|-----------|------|
| [1] | 官方文档 | OpenClaw Feishu Channel 文档 (docs.openclaw.ai) | 官方插件功能、WebSocket 模式、config.yaml 配置 | A |
| [2] | 官方文档 | OpenClaw Core Features 文档 (docs.openclaw.ai) | Cron Jobs、Heartbeat、Multi-Agent Routing、Skills 系统、Lobster 工作流引擎 | A |
| [3] | GitHub 仓库 | m1heng/clawdbot-feishu (2,947 星标) | Bitable 多维表格 6 个操作工具（v0.1.7）、飞书文档/Wiki/Drive 集成 | A |
| [4] | 官方文档 | 飞书开放平台 - 事件订阅 API | `im.message.receive_v1` 事件、权限模型（`im:message.p2p_msg:readonly` / `im:message.group_at_msg:readonly` / `im:message.group_msg`）、WebSocket & Webhook 模式 | A |
| [5] | 官方文档 | 飞书开放平台 - 权限说明 | `im:message.group_msg` 标记为 sensitive 权限，需人工审核 | A |
| [6] | 视频/社区 | Danish Dhamani YouTube 演示 & OpenClaw 社区 | 邮件 triage 批量分类数百封邮件节省 4 小时；Gmail Rollup 每日汇总技能；Inbox Cleanup 技能 | B |
| [7] | 官方文档 | OpenClaw Approvals System | approvals 系统针对 exec 权限控制，非消息审核队列 | A |
| [8] | 调研报告 | OpenClaw 与 Lark 集成调研报告 (v3) | 官方插件功能矩阵、社区插件对比、部署路径选择 | A |
| [9] | 调研报告 | OpenClaw 使用场景深度调研报告 | Email Triage 场景验证、Multi-Agent Routing、成本分析、安全风险 | A |
| [10] | 社区实践 | OpenClaw Discord/GitHub 社区 | 消息自动化最佳实践、Prompt 调优经验、成本控制策略 | B |

### 证据质量说明

- **A 级（官方权威）**：OpenClaw 官方文档、飞书开放平台官方文档、官方 GitHub 仓库
- **B 级（高质量社区）**：高星标开源项目、YouTube 实操演示、知名技术平台教程
- **C 级（参考补充）**：个人博客、社区讨论帖

---

## 附录 B：术语表

| 术语 | 说明 |
|------|------|
| **Triage** | 分拣/分流，源自医疗急救的伤情分类概念，在本报告中指消息的自动分类和优先级排序 |
| **Bitable** | 飞书多维表格，类似 Airtable 的数据库+表格+看板工具 |
| **Cron Job** | 基于 cron 表达式的定时任务调度 |
| **Heartbeat** | 心跳机制，OpenClaw 的周期性主动检查和推送系统 |
| **Multi-Agent Routing** | 多代理路由，将不同类型的请求分配给不同的 AI Agent 处理 |
| **WebSocket** | 全双工通信协议，支持客户端和服务端之间的持久连接 |
| **System Prompt** | 系统提示词，定义 AI Agent 的角色、规则和行为边界 |
| **Prompt Injection** | 提示注入攻击，通过恶意输入操纵 AI Agent 行为 |
| **Sensitive Permission** | 飞书开放平台的敏感权限，需要管理员人工审核才能获批 |

---

> **免责声明：** 本报告基于 2026 年 2 月 11 日可获取的公开信息撰写。OpenClaw 和飞书开放平台均处于快速迭代期，具体 API 能力和配置方式可能随版本更新而变化。报告中的 config.yaml 示例为示意性配置，实际部署时请以官方文档最新版本为准。分类准确率和成本估算基于类比推算和社区经验，实际效果因使用场景而异。
