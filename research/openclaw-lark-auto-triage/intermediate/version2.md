# OpenClaw + Lark（飞书）消息自动收集、分类整理与审核方案可行性调研

> **版本：** v2.0
> **日期：** 2026-02-11
> **作者角色：** 技术架构师
> **受众：** 有 OpenClaw 基础认知的技术开发者
> **状态：** 完成

---

## 1. 执行摘要

**能不能实现？能。但需要分场景讨论，且部分场景需要架构变通。**

核心结论如下：

1. **场景 A（Bot 为中心的消息收集）完全可行**。让别人直接给 Bot 发消息或在群聊中 @Bot，OpenClaw 官方飞书插件 `@openclaw/feishu` 原生支持此场景，消息会自动进入 AI 处理管道，无需额外开发 [1][2]。

2. **场景 B（群聊 @mention 监听——别人 @你本人，而非 Bot）有条件可行**。需要 Bot 拥有 `im:message.group_msg` 权限（sensitive 权限，需飞书管理员审批）来读取群聊全量消息，然后由 AI 从中过滤出 @你 的消息；或者通过飞书自动化规则在有人 @你 时自动转发给 Bot [3][4]。

3. **场景 C（私信代理——别人给你本人发私信）需要变通**。Bot 无法直接读取你和其他人之间的私聊。需要通过以下变通方案之一：(a) 引导别人直接给 Bot 发消息；(b) 你手动/通过飞书自动化将关键消息转发给 Bot；(c) 飞书邮件通知 + Email Triage 间接处理 [3][4]。

4. **AI 自动分类 + 人工审核工作流是本方案的核心亮点**。OpenClaw 的 Email Triage 场景已经充分验证了"AI 分类 -> 人工审核 -> 自动处理"的模式 [5]。结合飞书 Bitable（多维表格）作为审核看板，可以实现：AI 自动将消息分类写入 Bitable，用户在多维表格中快速审核确认，只有 AI 置信度低的消息才需要手动介入。

5. **实现周期估计 2-4 天**（对有 OpenClaw 经验的开发者），**月运营成本约 $15-50**（取决于消息量和模型选择）。

| 子需求 | 可行性评级 | 说明 |
|--------|-----------|------|
| 被动收集（Bot 中心） | **完全可行** | 原生支持 |
| 被动收集（@人类用户） | **有条件可行** | 需 sensitive 权限或转发机制 |
| 被动收集（人类私信） | **需要变通** | Bot 无法读取他人私聊 |
| AI 分类整理 | **完全可行** | AGENTS.md + Multi-Agent Routing |
| 审核确认 | **完全可行** | Bitable 看板 + 飞书通知 |
| 异常处理/人工干预 | **完全可行** | 置信度阈值 + 手动分类队列 |

---

## 2. 需求拆解与可行性评估

### 2.1 子需求一：被动收集

**需求描述**：当别人在飞书给我发消息或 @mention 我时，系统自动捕获这些消息。

**可行性评级**：分场景评估（详见第 3 节）

| 消息来源 | 技术实现 | 可行性 |
|---------|---------|--------|
| 别人给 Bot 发私信 | 飞书 `im.message.receive_v1` 事件 + `im:message.p2p_msg:readonly` 权限 [3] | **完全可行** |
| 群聊中 @Bot | 飞书 `im.message.receive_v1` 事件 + `im:message.group_at_msg:readonly` 权限 [3] | **完全可行** |
| 群聊中 @我（人类） | 需 `im:message.group_msg` (sensitive) 权限 + AI 过滤 [3] | **有条件可行** |
| 别人给我（人类）发私信 | Bot 无法访问你的私聊 [4] | **需要变通** |

**关键约束**：飞书的安全模型设计决定了 Bot 与人类用户是独立的实体。Bot 能读取自己参与的对话，但不能读取人类用户之间的私聊。这是平台安全设计，不是技术限制。

### 2.2 子需求二：AI 分类整理

**需求描述**：OpenClaw 自动将收集到的消息按主题/紧急度/类型等维度分类整理。

**可行性评级**：**完全可行**

技术依据：
- OpenClaw 的 Email Triage 场景已成熟验证了消息分类能力 [5][6]——AI 可将邮件分为紧急/重要/普通/垃圾四级，准确率高
- AGENTS.md 支持定义详细的分类规则和 System Prompt [7]
- Multi-Agent Routing 可为不同分类任务设置专门的 Agent [8]
- 飞书消息的结构化程度高于邮件（包含发送者信息、群组上下文、@mention 对象等），有利于分类

**分类维度建议**：

| 维度 | 分类选项 | 判断依据 |
|------|---------|---------|
| 紧急度 | 紧急 / 重要 / 普通 / 低优先级 | 关键词、发送者角色、上下文 |
| 类型 | 任务请求 / 信息通知 / 问题咨询 / 讨论参与 / 审批事项 / 闲聊 | 消息意图分析 |
| 主题 | 项目 A / 项目 B / 行政事务 / 技术问题 / ... | 自定义主题列表 + AI 推断 |
| 需回复 | 需要 / 不需要 / AI 可代回复 | 消息结构和意图分析 |
| AI 置信度 | 高 / 中 / 低 | AI 自评分 |

### 2.3 子需求三：审核确认

**需求描述**：用户只需快速审核确认 AI 的处理结果，不需要持续关注每一条消息。

**可行性评级**：**完全可行**

这是本方案中最关键也最有价值的部分。设计思路：

1. **Bitable 多维表格作为审核看板**：AI 将分类结果写入飞书多维表格，用户通过看板视图快速浏览和批量确认 [2][9]
2. **定时汇总推送**：通过 OpenClaw Cron Jobs，定期（如每 2 小时）向用户推送摘要消息 [7]
3. **一键确认机制**：用户可以在 Bitable 中直接修改分类或标记"已确认"，也可以通过飞书 Bot 回复"确认"
4. **差异化审核流**：高置信度的分类自动通过，低置信度的进入待审核队列

**审核工作流设计详见第 4.4 节。**

### 2.4 子需求四：异常处理

**需求描述**：只有 AI 无法确定分类的模糊消息才需要用户手动介入。

**可行性评级**：**完全可行**

实现机制：
- AI 在分类时输出**置信度评分**（通过 System Prompt 引导）
- 高置信度（>80%）：自动分类，写入 Bitable，标记"自动处理"
- 中置信度（50-80%）：自动分类但标记"待确认"，进入审核队列
- 低置信度（<50%）：标记"需手动分类"，向用户发送即时通知
- 用户可在 Bitable 中设置规则：对特定发送者或群组始终自动信任

---

## 3. 三种场景的技术方案对比

### 3.1 场景 A：Bot 为中心的消息收集（完全可行）

**核心思路**：不是监听"别人给你发的消息"，而是让别人直接与 Bot 交互。Bot 是消息的第一接收者。

```
发送者 ──发消息/@ Bot──> 飞书 Bot ──事件订阅──> OpenClaw ──AI 分类──> Bitable
```

**技术实现**：

1. 在飞书开放平台创建企业自建应用，开启 Bot 能力
2. 配置事件订阅 `im.message.receive_v1`
3. 申请权限：
   - `im:message.p2p_msg:readonly` — 读取私聊消息
   - `im:message.group_at_msg:readonly` — 接收群聊 @mention 消息
4. OpenClaw 通过 `@openclaw/feishu` 插件接收消息 [1]

**优点**：
- 标准方案，OpenClaw 官方原生支持 [1]
- 权限要求最低，无需 sensitive 权限
- WebSocket 模式无需公网 IP [1]
- 配置简单，15-30 分钟可完成 [1]

**缺点**：
- 需要引导别人改变发消息的习惯（给 Bot 发而非给你发）
- 你无法被动收集别人发给"你本人"的消息

**适用场景**：
- 团队内推行"有事找 Bot"的工作模式
- Bot 作为项目沟通的统一入口
- 新建的工作群直接拉入 Bot 并设为主要联系点

### 3.2 场景 B：群聊 @mention 监听（有条件可行）

**核心思路**：Bot 加入群聊后，监听所有消息，从中过滤出 @你（人类用户）的消息。

```
发送者 ──在群里 @你──> 群聊全量消息 ──Bot 监听──> OpenClaw ──过滤 @你 的消息──> AI 分类──> Bitable
```

**方案 B-1：全量消息监听**

技术实现：
1. Bot 加入目标群聊
2. 申请 `im:message.group_msg` 权限（**sensitive 权限**，需飞书管理员审批）[3]
3. Bot 接收群聊所有消息
4. AI Agent 的 System Prompt 中配置：只处理 @你（指定 user_id）的消息，忽略其他消息

```yaml
# AGENTS.md 片段 - 群聊过滤逻辑
你是一个消息分类助手。
规则：
1. 只处理消息中 @mention 了用户 ID 为 "{YOUR_USER_ID}" 的消息
2. 如果消息中没有 @mention 该用户，回复 "SKIP"
3. 对符合条件的消息执行分类...
```

**优点**：
- 能捕获所有 @你 的群聊消息
- 对发送者完全透明，无需改变任何人的行为习惯

**缺点**：
- 需要 sensitive 权限，企业管理员可能不批准
- Bot 会接收群聊全量消息，带来隐私和成本问题（每条消息都会消耗 AI Token）
- 高流量群聊中成本可能快速增长

**成本优化**：使用两层过滤架构——第一层用正则/关键词匹配（零成本）过滤出 @你 的消息，仅将这些消息送入 AI 分类。

**方案 B-2：飞书自动化转发**

技术实现：
1. 在飞书工作台 > 自动化 中创建自动化规则
2. 触发条件：群聊中有人 @你
3. 动作：自动将该消息转发给 Bot（私聊）
4. Bot 收到转发的消息后由 OpenClaw 处理

```
发送者 ──在群里 @你──> 飞书自动化规则 ──转发──> Bot 私聊 ──> OpenClaw ──AI 分类──> Bitable
```

**优点**：
- 不需要 sensitive 权限
- 只转发 @你 的消息，精确且低成本
- 利用飞书平台能力，无需自研过滤逻辑

**缺点**：
- 依赖飞书自动化功能（需要企业版或高级版）
- 转发后的消息可能丢失部分上下文（如原始群聊名称、前后文消息）
- 自动化规则的灵活性有限

**推荐**：方案 B-2 优先。如果飞书自动化功能不可用或不满足需求，再考虑方案 B-1。

### 3.3 场景 C：私信代理（需要变通）

**核心思路**：Bot 无法直接读取你和别人之间的私聊消息。需要通过间接方式获取。

**方案 C-1：引导私信到 Bot（推荐）**

最直接的变通：让需要联系你的人直接给 Bot 发消息。

实现方式：
- 在飞书个人签名/状态中注明："工作事务请联系 @YourBot"
- 在常用群聊中置顶说明
- 将 Bot 设置为你的"数字代理人"

```
发送者 ──给 Bot 发私信──> OpenClaw ──AI 分类──> Bitable
                                      │
                                      └──> 需要你回复的消息 ──通知你──> 你决定如何回复
```

**方案 C-2：手动/半自动转发**

你在收到重要私信后，手动转发给 Bot 进行分类和跟踪。

**方案 C-3：飞书消息通知 -> Email Triage**

飞书支持将消息通知发送到邮箱。通过 OpenClaw 的 Email Triage 能力间接处理：
1. 在飞书设置中启用"消息通知发送到邮箱"
2. OpenClaw 通过 Gmail/邮箱集成读取这些通知邮件 [5]
3. AI 从邮件通知中提取消息内容和发送者信息
4. 执行分类和整理

**缺点**：增加了一层间接性，延迟较高，信息可能不完整。

### 3.4 三种场景对比总结

| 维度 | 场景 A：Bot 中心 | 场景 B：群聊 @mention | 场景 C：私信代理 |
|------|----------------|---------------------|----------------|
| **可行性** | 完全可行 | 有条件可行 | 需要变通 |
| **权限要求** | 基础权限 | sensitive 权限或飞书自动化 | 基础权限 |
| **用户行为改变** | 需要（发消息给 Bot） | 不需要 | 需要（推荐 C-1） |
| **消息完整性** | 完整 | 完整（B-1）/ 部分（B-2） | 视方案而定 |
| **隐私影响** | 低 | 高（B-1）/ 低（B-2） | 低 |
| **实现复杂度** | 低 | 中 | 中 |
| **运营成本** | 低 | 中-高（B-1）/ 低（B-2） | 低 |
| **推荐程度** | 强烈推荐 | 推荐 B-2 方案 | 推荐 C-1 方案 |

---

## 4. 推荐架构方案

### 4.1 整体架构图

```
                           ┌──────────────────────────────────────────────────────┐
                           │                   飞书开放平台                         │
                           │                                                      │
  ┌──────────┐             │  ┌─────────────┐  ┌──────────────┐  ┌────────────┐  │
  │ 发送者 A  │──私信 Bot──>│  │ Bot 私聊    │  │ 群聊 @Bot    │  │ 群聊 @你   │  │
  │ 发送者 B  │──群里 @Bot─>│  │ 消息事件    │  │ 消息事件     │  │ (自动化    │  │
  │ 发送者 C  │──群里 @你──>│  │             │  │              │  │  转发到Bot) │  │
  └──────────┘             │  └──────┬──────┘  └──────┬───────┘  └─────┬──────┘  │
                           │         │                │                │         │
                           └─────────┼────────────────┼────────────────┼─────────┘
                                     │                │                │
                                     ▼                ▼                ▼
                           ┌──────────────────────────────────────────────────────┐
                           │              消息收集层（Message Collector）            │
                           │                                                      │
                           │  @openclaw/feishu 插件 (WebSocket 长连接)              │
                           │  • 接收所有发给 Bot 的消息                              │
                           │  • 统一消息格式（sender, content, source, timestamp）    │
                           │  • 消息去重与缓存                                      │
                           └────────────────────────┬─────────────────────────────┘
                                                    │
                                                    ▼
                           ┌──────────────────────────────────────────────────────┐
                           │              AI 分类层（Triage Agent）                 │
                           │                                                      │
                           │  OpenClaw Agent (Claude Sonnet 4)                     │
                           │  • AGENTS.md 定义分类规则                               │
                           │  • 输出：紧急度 / 类型 / 主题 / 是否需回复 / 置信度       │
                           │  • 高置信度 → 自动处理                                  │
                           │  • 低置信度 → 标记待审核                                │
                           └──────────┬──────────────────────────┬────────────────┘
                                      │                          │
                                      ▼                          ▼
                  ┌────────────────────────────────┐  ┌────────────────────────────┐
                  │      Bitable 审核看板             │  │     通知推送层                │
                  │      (飞书多维表格)                │  │                             │
                  │                                │  │  • 紧急消息 → 即时通知         │
                  │  • 所有消息的分类结果              │  │  • 定时汇总 → Cron 推送       │
                  │  • 看板视图：待审核 / 已确认 /     │  │  • 异常消息 → 提醒人工介入     │
                  │    已处理 / 已忽略                │  │                             │
                  │  • 支持批量操作                   │  └────────────────────────────┘
                  │  • AI 建议的回复草稿              │
                  └────────────────────────────────┘
                                      │
                                      ▼
                  ┌────────────────────────────────┐
                  │      自动处理层                   │
                  │                                │
                  │  • AI 已确认的消息 → 自动归档     │
                  │  • AI 可代回复的 → 生成草稿       │
                  │  • 定时清理已处理消息             │
                  └────────────────────────────────┘
```

### 4.2 消息收集层设计

消息收集层负责统一接收和规范化所有来源的飞书消息。

**核心组件**：`@openclaw/feishu` 官方插件

**配置示例（config.yaml）**：

```yaml
channels:
  feishu:
    app_id: "cli_xxxxxxxxxxxx"
    app_secret: "${FEISHU_APP_SECRET}"    # 使用环境变量
    # domain: "lark"                       # Lark 国际版取消注释
    features:
      streaming: true
      group_chat: true
      mention_only: false                  # 设为 false 以接收群聊全量消息（如需场景 B-1）
      media:
        image: true
        file: true

# 如需 Bitable 操作能力，叠加社区插件
plugins:
  - name: "@m1heng-clawd/feishu"
    config:
      tools:
        bitable: true                      # 启用多维表格操作
        docs: false
        wiki: false
        drive: false
```

**消息规范化结构**：

```json
{
  "id": "msg_xxxxxx",
  "source": "feishu_group",
  "group_name": "项目 Alpha 工作群",
  "sender": {
    "user_id": "ou_xxxxxx",
    "name": "张三",
    "department": "产品部"
  },
  "content": "@ 李四 请帮忙看一下这个需求文档，周三前给反馈",
  "mentions": ["ou_yyyyyy"],
  "timestamp": "2026-02-11T10:30:00+08:00",
  "message_type": "text",
  "is_at_me": true
}
```

### 4.3 AI 分类层设计

AI 分类层是整个方案的智能核心，基于 OpenClaw 的 Agent 系统实现。

**AGENTS.md 配置示例**：

```markdown
# Triage Agent - 飞书消息分类助手

## 角色定义
你是一个专业的消息分类助手，负责对收到的飞书消息进行智能分类和优先级排序。

## 分类规则

### 紧急度判断标准
- **紧急（P0）**：包含"紧急""ASAP""立即""马上""今天必须"等关键词；来自直属上级或 VIP 联系人；明确的截止时间在 24 小时内
- **重要（P1）**：明确的任务请求且有截止时间；需要你做决策或审批的事项；来自重要合作方
- **普通（P2）**：一般性的工作讨论；信息同步类消息；截止时间在一周以上
- **低优先级（P3）**：FYI 类消息；闲聊；群公告中不直接相关的内容

### 类型判断标准
- **任务请求**：消息中包含明确的行动要求（"请帮忙""能否""需要你"）
- **信息通知**：单向信息传递，不需要回复（"通知""FYI""周知"）
- **问题咨询**：向你提问或征求意见（"怎么看""什么时候""如何"）
- **讨论参与**：邀请你参与讨论（"大家讨论一下""有什么想法"）
- **审批事项**：需要你审批或确认的流程（"请审批""请确认"）
- **闲聊**：非工作相关的社交性消息

### 主题推断
根据消息内容和群聊名称推断所属主题/项目。如果无法确定，标记为"未分类"。

## 输出格式
对每条消息，输出以下 JSON 格式的分类结果：

```json
{
  "urgency": "P0|P1|P2|P3",
  "type": "任务请求|信息通知|问题咨询|讨论参与|审批事项|闲聊",
  "topic": "推断的主题/项目名",
  "needs_reply": true|false,
  "suggested_action": "简要建议（如：需要在周三前回复确认方案）",
  "draft_reply": "如 needs_reply 为 true，提供回复草稿",
  "confidence": 0.0-1.0,
  "summary": "一句话摘要"
}
```

## 特殊规则
1. 如果消息来自 VIP 联系人列表（见下方），紧急度至少为 P1
2. 如果 confidence < 0.5，在 suggested_action 中注明"建议人工复核"
3. 如果消息是纯表情/贴纸，标记为"闲聊"，confidence 设为 1.0
4. 如果消息包含文件/图片附件，在 summary 中注明"[含附件]"

## VIP 联系人
- ou_boss001（直属上级：王总）
- ou_client001（重要客户：李总）

## 模型选择
- 默认使用 Claude Sonnet 4（性价比最优）
- 当 confidence < 0.5 时，可升级到 Claude Opus 4.5 重新分类
```

**分类标准示例表**：

| 消息示例 | 紧急度 | 类型 | 置信度 |
|---------|--------|------|--------|
| "@你 线上出 bug 了，紧急修复" | P0 | 任务请求 | 0.95 |
| "@你 请帮忙审批一下这个采购单" | P1 | 审批事项 | 0.90 |
| "@你 下周的方案讨论会，你什么时候有空" | P2 | 问题咨询 | 0.85 |
| "@你 FYI 新版设计稿已上传到云盘" | P3 | 信息通知 | 0.92 |
| "@你 周末聚餐去不去" | P3 | 闲聊 | 0.88 |
| "@你 这个需求变更你怎么看" | P2 | 讨论参与 | 0.70 |
| "@你 [一张截图]" | P2 | 未知 | 0.35 |

### 4.4 审核工作流设计（Bitable 看板方案）

这是用户最关心的部分。审核工作流的核心设计原则是：**让用户花最少的时间做最关键的决策**。

#### 4.4.1 Bitable 表结构设计

**主表：消息分类看板**

| 字段名 | 字段类型 | 说明 | 示例值 |
|--------|---------|------|--------|
| 消息ID | 文本 | 唯一标识 | msg_abc123 |
| 收到时间 | 日期时间 | 消息接收时间 | 2026-02-11 10:30 |
| 发送者 | 文本 | 发送者姓名 | 张三 |
| 发送者部门 | 文本 | 发送者所属部门 | 产品部 |
| 来源群/频道 | 文本 | 消息来源 | 项目 Alpha 工作群 |
| 消息摘要 | 文本 | AI 生成的一句话摘要 | 张三请求在周三前确认需求方案 |
| 原始内容 | 文本 | 完整消息内容 | @你 请帮忙看一下这个需求文档... |
| 紧急度 | 单选 | P0/P1/P2/P3 | P1 |
| 类型 | 单选 | 任务请求/信息通知/... | 任务请求 |
| 主题 | 单选 | 所属项目/主题 | 项目 Alpha |
| 需要回复 | 复选框 | 是否需要你回复 | true |
| AI 建议动作 | 文本 | AI 建议的处理方式 | 需要在周三前回复确认方案 |
| AI 回复草稿 | 文本 | AI 生成的回复草稿 | 好的，我会在周二晚上前审阅... |
| AI 置信度 | 数字 | 0.0-1.0 | 0.85 |
| 审核状态 | 单选 | 待审核/已确认/已处理/已忽略/需手动分类 | 待审核 |
| 处理备注 | 文本 | 你的处理备注 | （空） |
| 自动处理 | 复选框 | 是否由 AI 自动处理 | false |

**辅助表：VIP 联系人**

| 字段名 | 字段类型 | 说明 |
|--------|---------|------|
| 用户 ID | 文本 | 飞书 user_id |
| 姓名 | 文本 | 联系人姓名 |
| 角色 | 单选 | 上级/客户/同事/... |
| 默认紧急度 | 单选 | 该联系人消息的最低紧急度 |

**辅助表：分类规则**

| 字段名 | 字段类型 | 说明 |
|--------|---------|------|
| 规则名 | 文本 | 规则标识 |
| 匹配条件 | 文本 | 触发条件描述 |
| 自动动作 | 单选 | 自动确认/自动忽略/升级 |
| 优先级 | 数字 | 规则执行优先级 |

#### 4.4.2 看板视图设计

在 Bitable 中创建以下看板视图：

**视图一：审核看板（主工作视图）**

```
┌───────────────┬───────────────┬───────────────┬───────────────┐
│   需手动分类    │    待审核      │    已确认      │    已处理      │
│   (AI 不确定)  │  (AI 已分类)   │  (你已确认)    │  (已执行动作)   │
├───────────────┼───────────────┼───────────────┼───────────────┤
│ [P?] 张三      │ [P0] 王总     │ [P1] 李总     │ [P2] 赵六     │
│   发了一张截图  │   线上 bug     │   采购审批     │   方案确认     │
│   置信度: 0.35 │   紧急修复     │               │   已回复       │
│               │               │               │               │
│               │ [P1] 张三     │ [P2] 钱七     │ [P3] 孙八     │
│               │   需求确认     │   会议时间     │   FYI 通知     │
│               │   周三截止     │               │   已读         │
└───────────────┴───────────────┴───────────────┴───────────────┘
```

**视图二：紧急视图（按紧急度过滤）**
- 仅显示 P0 和 P1 的消息
- 按收到时间排序

**视图三：待回复视图**
- 仅显示"需要回复 = true"且"审核状态 != 已处理"的消息
- 显示 AI 回复草稿供参考

**视图四：统计仪表盘**
- 今日消息总数 / 各紧急度分布 / 类型分布
- AI 自动处理率 / 平均置信度
- 待审核积压数量

#### 4.4.3 审核流程详细设计

```
消息进入
    │
    ▼
AI 分类（输出置信度）
    │
    ├── 置信度 >= 0.8 ──> 自动写入 Bitable，状态 = "已确认"
    │                      │
    │                      ├── 紧急度 P0 ──> 立即通知用户（飞书 Bot 消息）
    │                      └── 其他 ──> 等待下次定时汇总
    │
    ├── 0.5 <= 置信度 < 0.8 ──> 写入 Bitable，状态 = "待审核"
    │                              │
    │                              └── 等待用户在 Bitable 中确认或修改分类
    │
    └── 置信度 < 0.5 ──> 写入 Bitable，状态 = "需手动分类"
                           │
                           └── 立即通知用户："有一条消息 AI 无法分类，请手动处理"
```

**用户审核操作**（在 Bitable 中）：

1. **快速确认**：查看 AI 分类结果，如果正确，将状态改为"已确认"
2. **修改分类**：如果 AI 分类不准确，手动修改紧急度/类型/主题，然后确认
3. **批量操作**：选中多条消息，批量标记为"已确认"或"已忽略"
4. **使用 AI 草稿回复**：如果 AI 生成的回复草稿合适，一键发送（或编辑后发送）

**定时汇总推送**（Cron Job）：

```yaml
# OpenClaw Cron 配置
cron:
  triage_summary:
    schedule: "0 */2 * * *"    # 每 2 小时执行
    agent: "triage-summary"
    action: |
      查询 Bitable 中最近 2 小时的消息分类结果，生成摘要报告：
      1. 新收到 X 条消息
      2. 其中紧急 X 条、重要 X 条
      3. 待你审核 X 条
      4. AI 已自动处理 X 条
      将摘要通过飞书 Bot 发送给我。
```

### 4.5 自动处理与人工干预的边界定义

| 场景 | AI 自动处理 | 人工干预 |
|------|-----------|---------|
| 高置信度分类（>0.8） | 自动写入 Bitable 并标记"已确认" | 用户可事后复查修改 |
| P3 闲聊类消息 | 自动标记"已忽略" | 用户可取消忽略 |
| 重复/相似消息 | 自动合并，只保留最新 | - |
| AI 回复草稿 | **不自动发送**，仅生成草稿 | 用户确认后发送 |
| VIP 联系人消息 | 自动提升紧急度 | 用户确认后处理 |
| 低置信度消息（<0.5） | 仅写入 Bitable | 用户必须手动分类 |
| 涉及金额/合同的消息 | 仅标记紧急 | 用户必须亲自处理 |
| 审批类消息 | 仅通知 | 用户必须亲自审批 |

**核心原则**：AI 的自动处理权限严格限于"分类"和"通知"层面。任何涉及"代替用户回复""代替用户执行操作"的行为，都需要人工确认后才执行。

---

## 5. 具体实现步骤

### Step 1：飞书应用创建与权限配置（预计 30 分钟）

1. 登录 [飞书开放平台](https://open.feishu.cn/)
2. 创建**企业自建应用**
3. 开启 **Bot 能力**
4. 获取 **App ID** 和 **App Secret**
5. 配置权限：

| 权限 | 用途 | 必需/可选 |
|------|------|----------|
| `im:message.p2p_msg:readonly` | 读取 Bot 私聊消息 | 必需 |
| `im:message.group_at_msg:readonly` | 接收群聊 @Bot 消息 | 必需 |
| `im:message.group_msg` | 读取群聊全量消息（场景 B-1） | 可选（sensitive） |
| `im:resource` | 读取消息中的图片/文件 | 推荐 |
| `bitable:app` | 操作多维表格 | 必需（审核看板） |
| `contact:user.base:readonly` | 读取发送者基本信息 | 推荐 |

6. 配置事件订阅：
   - 选择 **WebSocket 模式**（无需公网 IP）[1]
   - 订阅事件 `im.message.receive_v1`

7. 发布应用版本（需管理员审批）

### Step 2：OpenClaw 飞书插件配置（预计 15 分钟）

确保 OpenClaw 版本 >= 2026.2。

```bash
# 1. 确认版本
openclaw --version

# 2. 安装官方飞书插件（如未内置）
openclaw plugins install @openclaw/feishu

# 3. 安装 Bitable 操作插件
openclaw plugins install @m1heng-clawd/feishu

# 4. 配置飞书渠道
openclaw channels add
# 交互式选择 Feishu/Lark -> 输入 App ID 和 App Secret
```

**config.yaml 完整配置**：

```yaml
# OpenClaw 飞书消息 Triage 配置

# AI 模型配置
ai:
  provider: "anthropic"
  model: "claude-sonnet-4-20250514"        # 默认使用 Sonnet（性价比优）
  fallback_model: "claude-haiku-20250307"  # 降级模型

# 飞书渠道配置
channels:
  feishu:
    app_id: "cli_xxxxxxxxxxxx"
    app_secret: "${FEISHU_APP_SECRET}"
    features:
      streaming: true
      group_chat: true
      mention_only: false    # 接收群聊全量消息（场景 B 需要）
      media:
        image: true
        file: true

# Bitable 插件配置
plugins:
  - name: "@m1heng-clawd/feishu"
    config:
      tools:
        bitable: true

# Gateway 配置
gateway:
  bind: "127.0.0.1"
  port: 18789
```

### Step 3：AI Agent 分类逻辑配置（预计 1-2 小时）

创建 `.openclaw/agents/triage/AGENTS.md`，内容参见 4.3 节的 AGENTS.md 配置示例。

**关键配置要点**：

1. **分类规则要具体化**：不要用模糊的指令，而要用明确的判断标准
2. **VIP 联系人列表要维护**：定期更新
3. **置信度阈值可调整**：初期可将自动处理阈值调高（如 0.9），观察一段时间后逐步降低
4. **输出格式要严格**：确保 AI 输出可被程序解析的 JSON 格式

**Multi-Agent 路由配置**（可选，进阶）：

```yaml
agents:
  triage-classifier:
    model: "claude-sonnet-4-20250514"
    description: "消息分类专用 Agent"
    skills: ["message-classify"]

  triage-summary:
    model: "claude-haiku-20250307"
    description: "定时汇总专用 Agent（使用轻量模型降低成本）"
    skills: ["summary-report"]

  triage-reply:
    model: "claude-sonnet-4-20250514"
    description: "回复草稿生成 Agent"
    skills: ["draft-reply"]

routing:
  rules:
    - event: "new_message"
      agent: "triage-classifier"
    - event: "cron_summary"
      agent: "triage-summary"
    - event: "draft_reply_request"
      agent: "triage-reply"
```

### Step 4：Bitable 审核看板搭建（预计 1 小时）

1. 在飞书中创建新的多维表格（Bitable）
2. 按 4.4.1 节的表结构创建字段
3. 创建四个视图（审核看板、紧急视图、待回复视图、统计仪表盘）
4. 记录 Bitable 的 `app_token` 和 `table_id`

**通过 OpenClaw Agent 自动写入 Bitable**：

在分类 Agent 的工具链中，使用 `@m1heng-clawd/feishu` 提供的 Bitable 工具 [2][9]：

```
当你完成消息分类后，使用 bitable_create_record 工具将分类结果写入多维表格。
参数：
- app_token: "bascnXXXXXXXX"
- table_id: "tblXXXXXXXX"
- fields: {分类结果对应的字段}
```

5. 配置 Bitable 自动化（可选）：
   - 当"审核状态"改为"已确认"时，自动触发后续处理
   - 当"紧急度"为 P0 时，自动发送飞书通知

### Step 5：Cron 定时汇总任务配置（预计 30 分钟）

```bash
# 方式一：通过 OpenClaw 内置 Cron 系统
# 在 config.yaml 中配置

cron:
  jobs:
    - name: "morning_triage_summary"
      schedule: "0 9 * * 1-5"        # 工作日早上 9 点
      command: |
        查询 Bitable 中昨晚至今早的新消息，生成摘要：
        1. 总览：新消息 X 条
        2. 紧急待处理：列出 P0/P1 消息
        3. 待审核：X 条需要你确认
        4. 已自动处理：X 条
        通过飞书 Bot 发送给我。

    - name: "periodic_triage_summary"
      schedule: "0 */3 * * 1-5"      # 工作日每 3 小时
      command: |
        查询 Bitable 中最近 3 小时的新消息，如果有待审核或紧急消息，
        通过飞书 Bot 发送简短提醒。如果没有新消息，不发送。

    - name: "weekly_triage_report"
      schedule: "0 18 * * 5"         # 每周五下午 6 点
      command: |
        生成本周消息处理统计报告：
        - 总消息数、各紧急度分布、各类型分布
        - AI 自动处理率
        - 平均置信度趋势
        - 需要优化的分类规则建议
        写入 Bitable 的统计页面，并推送给我。
```

```bash
# 方式二：通过系统 crontab
crontab -e

# 工作日早上 9 点汇总
0 9 * * 1-5 /usr/bin/openclaw agent --message "执行每日消息汇总" --thinking high

# 每 3 小时检查
0 */3 * * 1-5 /usr/bin/openclaw agent --message "检查是否有紧急待处理消息" --thinking low
```

---

## 6. 成本估算

### 6.1 一次性成本

| 项目 | 成本 | 说明 |
|------|------|------|
| 飞书开放平台 | 免费 | 企业自建应用免费 |
| OpenClaw 软件 | 免费 | MIT 开源 |
| `@openclaw/feishu` 插件 | 免费 | 官方内置 |
| `@m1heng-clawd/feishu` 插件 | 免费 | 开源社区 |
| 开发配置时间 | 2-4 天 | 对有经验的开发者 |

### 6.2 月度运营成本

| 项目 | 成本范围 | 计算依据 |
|------|---------|---------|
| AI API 费用（分类） | $10-30/月 | 假设每天 50-200 条消息，使用 Sonnet 4（$3/MTok input, $15/MTok output）[10] |
| AI API 费用（汇总） | $3-8/月 | 使用 Haiku（$0.25/MTok），每天 3-5 次汇总 |
| AI API 费用（回复草稿） | $2-10/月 | 仅对需要回复的消息生成草稿 |
| 飞书多维表格 | 免费 | 飞书标准版包含 |
| 服务器（如需 24/7 运行） | $0-24/月 | 本地运行免费；云服务器 ~$24（DigitalOcean）|
| **月度总计** | **$15-72/月** | |

### 6.3 成本优化策略

1. **模型分级使用**：分类用 Sonnet，汇总用 Haiku，复杂消息才用 Opus [10]
2. **预过滤减少 AI 调用**：对群聊消息先用正则匹配 @你，只将命中的消息送入 AI
3. **批量处理**：累积 5-10 条消息后一次性送入 AI 分类，减少 API 调用次数
4. **缓存分类规则**：对相同发送者+相同群组的重复类型消息，缓存分类结果
5. **设置 API 预算上限**：在 Anthropic Console 设置月度预算上限 $50 [10]

### 6.4 与人工处理的对比

| 维度 | AI 自动 Triage | 人工处理 |
|------|---------------|---------|
| 每日耗时 | 10-15 分钟审核 | 1-2 小时逐条处理 |
| 响应速度 | 即时分类 | 取决于你何时查看 |
| 遗漏风险 | 低（全量处理） | 中-高（可能漏看） |
| 月成本 | $15-72 | 时间成本（按 $50/h 计，约 $1,000-2,000） |
| 扩展性 | 消息量增长不影响体验 | 线性增长 |

---

## 7. 风险与局限

### 7.1 技术风险

| 风险 | 影响 | 概率 | 缓解措施 |
|------|------|------|---------|
| AI 分类错误（误分紧急度） | 可能导致紧急消息被延迟处理 | 中 | 初期设置高阈值（0.9）；VIP 联系人规则兜底；定期审计分类准确率 |
| 飞书 API 变更 | 插件可能不兼容 | 低 | 使用官方插件，跟进版本更新 |
| WebSocket 连接断开 | 消息丢失 | 中 | OpenClaw 内置重连机制；考虑 `@xwang152/claw-lark` 的自动恢复 [11] |
| Bitable API 限流 | 高消息量时写入失败 | 低 | 批量写入；错误重试；消息队列缓冲 |
| Sensitive 权限审批被拒（场景 B） | 无法监听群聊 @mention | 中 | 改用飞书自动化转发方案（B-2）|

### 7.2 安全风险

| 风险 | 影响 | 缓解措施 |
|------|------|---------|
| Bot 接收的消息包含敏感信息 | AI API 会将消息内容发送到 Anthropic 服务器 | 告知团队成员不要给 Bot 发送机密信息；考虑本地 LLM 方案 |
| API Key 泄露 | 飞书 App Secret 和 Anthropic API Key 暴露 | 使用环境变量；不提交到 Git；定期轮换 |
| AI 生成不当回复 | 自动发送的回复可能不合适 | **严格禁止自动发送回复**，所有回复仅生成草稿 |
| OpenClaw 管理面板暴露 | 安全研究人员已发现大量暴露实例 [12] | Gateway 仅监听 127.0.0.1；使用 Tailscale；Docker 部署 |

### 7.3 功能局限

1. **无法实现完全被动收集**：对于场景 C（别人给你发私信），技术上不存在无感知的方案。必须接受某种程度的行为改变或信息损失。

2. **分类准确率取决于 System Prompt 质量**：初期需要大量调试和迭代分类规则。建议在前两周密集审核所有分类结果，根据错误案例优化 AGENTS.md。

3. **多语言/方言支持**：如果团队消息中混合中英文或包含行业术语、缩写，AI 可能误解。需要在 AGENTS.md 中补充行业词汇表。

4. **飞书自动化功能的限制**：场景 B-2 依赖飞书自动化，但该功能可能不支持所有飞书版本，且自定义规则的灵活性有限。

5. **图片/文件消息**：AI 可以理解图片内容（Claude 支持多模态），但处理速度和成本会显著增加。建议对图片消息仅做基础标记，不做深度分类。

---

## 8. 建议与下一步

### 8.1 推荐实施路径

**第一阶段（第 1 周）：场景 A 基础搭建**
- 创建飞书应用，配置基础权限
- 安装 OpenClaw 飞书插件
- 搭建 Bitable 审核看板
- 配置基础分类 Agent（先用简单规则）
- 在 2-3 个工作群中试运行

**第二阶段（第 2-3 周）：优化与扩展**
- 根据第一阶段的分类结果优化 AGENTS.md
- 添加 VIP 联系人规则
- 配置 Cron 定时汇总
- 尝试场景 B（申请 sensitive 权限或配置飞书自动化）
- 逐步调低置信度阈值（从 0.9 -> 0.8）

**第三阶段（第 4 周起）：常态运营**
- 推广到所有工作群
- 配置场景 C 的变通方案（引导私信到 Bot）
- 添加回复草稿生成功能
- 建立月度分类准确率审计机制

### 8.2 关键决策点

| 决策 | 选项 | 推荐 |
|------|------|------|
| 场景 B 实现方式 | B-1 全量监听 vs B-2 飞书自动化转发 | **B-2 优先**（低权限、低成本） |
| AI 模型选择 | Sonnet vs Opus vs Haiku | **Sonnet 为主**，Haiku 做汇总 |
| 审核看板 | Bitable vs 飞书 Bot 交互 vs 第三方工具 | **Bitable**（原生集成、看板视图强） |
| 部署方式 | 本地 vs Docker vs 云服务器 | **Docker 本地**（安全 + 免服务器成本）|
| 回复发送 | 自动发送 vs 仅生成草稿 | **仅生成草稿**（避免 AI 失控风险） |

### 8.3 长期演进方向

1. **自学习分类模型**：记录每次人工修正的分类结果，定期将修正案例加入 AGENTS.md 的示例中，实现分类精度持续提升
2. **跨平台消息 Triage**：扩展到微信、邮件等其他渠道，实现统一的消息分类看板
3. **自动回复能力**：当分类准确率稳定在 95%+ 后，可考虑对低风险消息（如闲聊、FYI 通知）开放 AI 自动回复
4. **团队共享 Triage**：将 Bitable 看板共享给助理/秘书，实现协作式消息处理
5. **飞书 Workflow 深度集成**：将审批类消息自动对接飞书审批流，实现端到端自动化

---

## 9. 附录：证据表与参考源

### 证据表

| 编号 | 来源类型 | 标题/描述 | 质量 | 关键数据点 |
|------|---------|-----------|------|-----------|
| [1] | 官方文档 | OpenClaw Feishu Channel 文档 | A | 官方插件功能、WebSocket 模式、配置方式 |
| [2] | GitHub 仓库 | m1heng/clawdbot-feishu（2,947 星） | A | Bitable 多维表格工具（v0.1.7+ 新增 6 个工具） |
| [3] | 官方文档 | 飞书开放平台事件订阅文档 | A | `im.message.receive_v1` 事件、权限体系 |
| [4] | 官方文档 | 飞书开放平台 Bot 能力文档 | A | Bot 消息接收范围、安全模型 |
| [5] | 使用案例 | OpenClaw Email Triage 场景验证 | B | AI 邮件分类准确率、4 小时工作量节省 |
| [6] | 视频评测 | VelvetShark "9 automations + 4 wild builds" | B | Email Triage 实操演示 |
| [7] | 官方文档 | OpenClaw AGENTS.md 与 Cron Jobs 文档 | A | System Prompt 配置、定时任务系统 |
| [8] | 技术指南 | Zen van Riel Multi-Agent 指南 | B | Multi-Agent Routing 配置与最佳实践 |
| [9] | npm 包 | @m1heng-clawd/feishu Bitable 工具 | B | `bitable_create_record` 等 6 个多维表格操作工具 |
| [10] | 使用报告 | OpenClaw 成本分析（多源汇总） | B | Sonnet $3/$15 MTok、Haiku $0.25/$1.25 MTok |
| [11] | npm 包 | @xwang152/claw-lark | B | 自动恢复机制、41 版本迭代 |
| [12] | 安全研究 | Breached.company / Cisco / Noma Security | A | 1,100+ 暴露实例、安全最佳实践 |

### 参考源列表

1. OpenClaw 官方飞书文档 — https://docs.openclaw.ai/zh-CN/channels/feishu
2. m1heng/clawdbot-feishu — https://github.com/m1heng/clawdbot-feishu
3. 飞书开放平台文档 — https://open.feishu.cn/document/server-docs/im-v1/message/events/receive
4. 飞书开放平台 Bot 能力 — https://open.feishu.cn/document/home/develop-a-bot
5. VelvetShark YouTube 评测 — https://www.youtube.com/watch?v=52kOmSQGt_E
6. OpenClaw 官方文档 — https://docs.openclaw.ai
7. Zen van Riel Multi-Agent Guide — https://zenvanriel.nl/ai-engineer-blog/openclaw-multi-agent-orchestration-guide/
8. @xzq-xu/feishu (npm) — https://www.npmjs.com/package/@xzq-xu/feishu
9. @xwang152/claw-lark (npm) — https://www.npmjs.com/package/@xwang152/claw-lark
10. OpenClaw GitHub Repository — https://github.com/openclaw/openclaw
11. Cisco 安全博客 — https://blogs.cisco.com/ai/personal-ai-agents-like-openclaw-are-a-security-nightmare
12. Noma Security 报告 — https://noma.security/blog/customers-gave-clawdbot-privileged-access-and-noone-asked-permission/

---

> **免责声明**：本报告基于公开可获取的文档和社区资源编写，信息时效截至 2026 年 2 月 11 日。OpenClaw 和飞书开放平台均处于快速迭代期，具体 API 和功能可能随版本更新而变化。建议在实际实施前进行独立验证，并以官方文档最新版本为准。报告中的成本估算基于 2026 年 2 月的模型定价，实际成本可能因使用模式和定价调整而有所不同。
