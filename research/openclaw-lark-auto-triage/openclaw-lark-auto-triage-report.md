# OpenClaw + Lark（飞书）消息自动收集、分类整理与审核方案可行性调研

> **日期：** 2026-02-11
> **受众：** 技术开发者（有 OpenClaw 基础认知）
> **目的：** 评估 OpenClaw 集成 Lark 实现消息自动收集、分类整理、人工审核的可行性

---

## 执行摘要

**核心结论：技术上完全可行，但需要分场景讨论，部分场景需要架构变通。**

1. **"别人给 Bot 发消息"和"群聊中 @Bot"完全可行。** OpenClaw 官方飞书插件 `@openclaw/feishu` 原生支持此场景，通过 WebSocket 长连接模式无需公网 IP，消息自动进入 AI 处理管道 [1][2]。

2. **"群聊中 @mention 人类用户"有条件可行。** 需要 `im:message.group_msg` 敏感权限（需飞书管理员审批，周期 1-2 周）来读取群聊全量消息后过滤；或者通过飞书自动化规则将 @你 的消息自动转发给 Bot（无需敏感权限）[3][4]。

3. **"别人给人类用户发私聊"需要变通。** Bot 无法直接读取你和其他人之间的私聊，这是飞书平台安全设计。推荐引导对方直接给 Bot 发消息，或通过飞书消息通知 -> Email Triage 间接处理 [3][4]。

4. **AI 自动分类已被充分验证。** OpenClaw 的邮件 triage 场景已成熟——AI 可批量分类数百封邮件并节省 4 小时工作量 [5]。飞书消息结构化程度高于邮件（含发送者信息、群组上下文、@mention 对象），分类效果预期更好。

5. **审核工作流是最大的设计缺口，但有成熟方案。** OpenClaw 的 approvals 系统是 exec 权限控制机制，非消息审核队列 [6]。推荐使用飞书多维表格（Bitable）作为审核看板——通过 `@m1heng-clawd/feishu` 插件的 6 个 Bitable 操作工具（v0.1.7+）实现 AI 自动写入 + 人工批量审核 [2]。

6. **推荐"收集-分类-审核"三阶段架构。** 第一阶段飞书事件订阅自动收集消息；第二阶段 AI Agent 按预设规则分类、摘要、草拟回复并输出置信度评分；第三阶段结果写入 Bitable 审核看板，高置信度自动处理，低置信度进入人工审核队列。

7. **实现周期预计 2-4 周分三期交付，月运营成本 $15-72。** 对有 OpenClaw 经验的开发者，第一期（基础消息收集）1 周可完成；月成本取决于消息量和模型选择。

| 子需求 | 可行性评级 | 说明 |
|--------|-----------|------|
| 被动收集（Bot 中心） | **完全可行** | 原生支持 |
| 被动收集（群聊 @人类用户） | **有条件可行** | 需 sensitive 权限或飞书自动化转发 |
| 被动收集（人类私聊） | **需要变通** | Bot 无法读取他人私聊 |
| AI 分类整理 | **完全可行** | AGENTS.md + Multi-Agent Routing |
| 审核确认 | **完全可行** | Bitable 看板 + 飞书通知 |
| 异常处理/人工干预 | **完全可行** | 置信度阈值 + 手动分类队列 |

---

## 研究问题与范围

### 核心问题

用户希望实现：**当别人在飞书给我发消息或 @mention 我时，OpenClaw 自动收集整理这些消息，分门别类处理好，我只需要审核确认即可，不需要持续关注。只有 AI 处理不好的模糊情况才需要手动处理。**

将此需求拆解为四个技术子问题：

| # | 子问题 | 关键约束 |
|---|--------|---------|
| Q1 | 飞书消息能否被自动收集？ | 区分私聊 vs 群聊、@Bot vs @人类 |
| Q2 | OpenClaw 能否自动分类整理这些消息？ | 准确率、分类维度、上下文理解 |
| Q3 | 能否构建审核工作流？ | 审核 UI、批量操作、确认后自动执行 |
| Q4 | 整体方案的可行性和实现成本？ | 开发周期、运维成本、技术风险 |

### 研究范围

| 维度 | 包含 | 排除 |
|------|------|------|
| 飞书 API | 事件订阅、Bot 消息、Bitable API | 飞书审批流、人事 API |
| OpenClaw 能力 | 飞书插件、Cron Jobs、Multi-Agent、Skills | 基础安装部署（已有报告覆盖 [7]） |
| 消息场景 | 私聊、群聊 @mention、群聊全量 | 飞书日历事件、飞书文档评论 |
| 审核方案 | Bitable 看板、消息卡片确认 | 自建 Web UI、第三方工单系统 |

### 研究方法

- 数据来源：OpenClaw 官方文档、飞书开放平台文档、GitHub 仓库（m1heng/clawdbot-feishu 2,947 星）、npm 包注册信息、社区实践案例
- 搜索策略：针对性搜索 OpenClaw 飞书集成、飞书事件订阅 API、消息自动化方案、Bitable 集成案例
- 已知局限：部分飞书开放平台文档页面无法直接抓取，通过搜索引擎缓存和社区转述获取信息

---

## 技术可行性分析

### 飞书事件订阅能力评估

飞书开放平台提供完整的消息事件订阅能力，是整个方案的数据入口层。

#### 权限与事件模型

| 权限标识 | 能力 | 敏感级别 | 审批难度 |
|---------|------|---------|---------|
| `im:message.p2p_msg:readonly` | 读取发给 Bot 的私聊消息 | 普通 | 低，自动审批 |
| `im:message.group_at_msg:readonly` | 接收群聊中 @mention Bot 的消息 | 普通 | 低，自动审批 |
| `im:message.group_msg` | 读取群聊所有消息 | **Sensitive** | **高，需人工审核** |

核心事件类型 `im.message.receive_v1` 在 Bot 接收到消息时触发，事件负载包含发送者 ID、消息内容、消息类型、所在群聊 ID 等完整上下文信息 [3]。

#### 两种事件接收模式

| 对比项 | WebSocket 长连接 | Webhook 回调 |
|--------|----------------|-------------|
| 公网 IP 要求 | 不需要 | 需要 |
| 实时性 | 高（持久连接） | 高（HTTP POST） |
| 部署复杂度 | 低 | 中（需反向代理） |
| OpenClaw 支持 | 官方默认模式 [1] | 社区插件支持 |
| 推荐场景 | 个人/小团队 | 企业高可用 |

**关键发现：** OpenClaw 官方飞书插件默认使用 WebSocket 长连接模式，无需公网 IP 即可接收飞书事件 [1]，大幅降低部署门槛。

### 消息收集的三种场景分析

#### 场景 A：Bot 为中心的消息收集（完全可行）

**核心思路**：让别人直接与 Bot 交互，Bot 是消息的第一接收者。

```
发送者 ──发消息/@ Bot──> 飞书 Bot ──事件订阅──> OpenClaw ──AI 分类──> Bitable
```

- 标准方案，OpenClaw 官方原生支持 [1]
- 权限要求最低，无需 sensitive 权限
- WebSocket 模式无需公网 IP，配置 15-30 分钟可完成
- 缺点：需要引导别人改变发消息习惯（给 Bot 发而非给你发）

#### 场景 B：群聊 @mention 人类用户（有条件可行）

Bot 加入群聊后，从消息流中过滤出 @你（人类用户）的消息。存在两种实现路径：

**路径 B-1：全量消息监听**

```
群聊消息流 --> 飞书开放平台（全量推送）--> Bot 接收 --> 过滤含 @mention 目标用户的消息
```

- 需要 `im:message.group_msg` sensitive 权限（需飞书管理员审批，周期 1-2 周）[3]
- 能捕获所有 @你 的群聊消息，对发送者完全透明
- 缺点：接收群聊全量消息带来隐私和成本问题
- 成本优化：使用两层过滤——第一层正则/关键词匹配（零成本）过滤出 @你 的消息，仅将这些送入 AI 分类

**路径 B-2：飞书自动化转发（推荐）**

```
发送者 ──在群里 @你──> 飞书自动化规则 ──转发──> Bot 私聊 ──> OpenClaw ──AI 分类──> Bitable
```

- 不需要 sensitive 权限
- 只转发 @你 的消息，精确且低成本
- 利用飞书平台能力，无需自研过滤逻辑
- 缺点：依赖飞书自动化功能（需企业版或高级版），转发后可能丢失部分上下文

**推荐策略：** 路径 B-2 优先（低门槛），同时申请路径 B-1 的 sensitive 权限（最终方案）。

#### 场景 C：私信代理（需要变通）

Bot 无法直接读取你和别人之间的私聊消息，这是飞书平台安全设计决定的。

**方案 C-1：引导私信到 Bot（推荐）**

在飞书个人签名/状态中注明："工作事务请联系 @YourBot"，将 Bot 设置为你的"数字代理人"。

**方案 C-2：手动/半自动转发**

收到重要私信后手动转发给 Bot 进行分类和跟踪。

**方案 C-3：飞书消息通知 -> Email Triage**

飞书支持将消息通知发送到邮箱，通过 OpenClaw 成熟的 Email Triage 能力间接处理 [5]。缺点是增加一层间接性，延迟较高。

#### 三种场景对比总结

| 维度 | 场景 A：Bot 中心 | 场景 B：群聊 @mention | 场景 C：私信代理 |
|------|----------------|---------------------|----------------|
| 可行性 | 完全可行 | 有条件可行 | 需要变通 |
| 权限要求 | 基础权限 | sensitive 权限或飞书自动化 | 基础权限 |
| 用户行为改变 | 需要（发消息给 Bot） | 不需要（B-1）/ 不需要（B-2） | 需要（推荐 C-1） |
| 消息完整性 | 完整 | 完整（B-1）/ 部分（B-2） | 视方案而定 |
| 隐私影响 | 低 | 高（B-1）/ 低（B-2） | 低 |
| 运营成本 | 低 | 中-高（B-1）/ 低（B-2） | 低 |

### OpenClaw 消息处理能力评估

OpenClaw 提供丰富的自动化原语满足消息收集、处理和响应的全部需求。

#### 核心能力矩阵

| 能力 | 说明 | 对应需求 |
|------|------|---------|
| **Cron Jobs** [8] | 定时任务系统，支持标准 cron 表达式 | 定时汇总消息、生成日报 |
| **Heartbeat** [8] | 心跳机制，周期性检查和主动推送 | 定期检查待审核项、提醒用户 |
| **Multi-Agent Routing** [8] | 多代理路由，不同 Agent 处理不同类型消息 | 工作消息 vs 生活消息分流 |
| **Skills 系统** [8] | 2999+ 社区技能，可自定义 | 分类逻辑、摘要生成、回复草拟 |
| **持久记忆** [8] | 跨会话记忆能力 | 记住用户偏好、历史分类规则 |
| **Lobster 工作流引擎** [8] | 复杂自动化管道 | 串联收集-分类-审核完整流程 |

#### 飞书插件能力

**官方插件 `@openclaw/feishu`** [1]：

- WebSocket 长连接模式，无需公网 IP
- 支持群聊、私聊、@mention
- 支持图片和文件消息
- 2026.2+ 版本内置

**社区插件 `@m1heng-clawd/feishu`** [2]（2,947 星标）：

在官方插件基础上扩展飞书深度集成：
- 飞书文档读写、Wiki 集成、Drive 文件管理
- **多维表格（Bitable）工具**（v0.1.7 新增 6 个操作工具）：创建表格、读取记录、写入记录、更新记录、删除记录、查询筛选
- 动态 Agent 创建

Bitable 工具是实现审核看板的关键拼图。

### AI 自动分类的可行性

#### 邮件 triage 的已验证能力映射 [5]

| 邮件场景能力 | 飞书消息场景映射 |
|-------------|---------------|
| 重要性排序（区分紧急 vs 普通） | 消息优先级判定 |
| 智能过滤（去除营销、通知类邮件） | 过滤系统通知、群聊噪音 |
| 内容摘要（提取核心内容） | 长消息/多条消息摘要 |
| 草拟回复（根据上下文自动草拟） | 草拟飞书消息回复 |
| 批量处理（一次处理数百封） | 批量处理积压消息 |
| 每日汇总（Gmail Rollup 技能） | 飞书消息日报 |

#### 分类维度设计

```
一级分类（按紧急程度）:
├── P0 紧急：需要立即回复（含"紧急"、"urgent"、deadline 临近、生产事故）
├── P1 重要：需要当天回复（工作任务、会议安排、审批请求、有 deadline）
├── P2 普通：可延迟回复（日常沟通、信息同步）
└── P3 低优先级：可忽略或批量处理（群聊闲聊、系统通知、FYI 消息）

二级分类（按类型）:
├── 任务请求：别人分配给我的工作任务（"请帮忙""能否""需要你"）
├── 问题咨询：别人向我提问/请教（"怎么看""什么时候""如何"）
├── 会议通知：会议邀请、时间变更
├── 审批事项：需要我审批/确认的事项
├── 讨论参与：邀请参与讨论（"大家讨论一下""有什么想法"）
├── 信息同步：FYI 类消息，不需回复（"通知""FYI""周知"）
├── 社交闲聊：问候、闲聊
└── 其他：AI 无法准确分类的消息

辅助维度：
├── 主题推断：根据消息内容和群聊名称推断所属项目
├── 是否需要回复：true / false / AI 可代回复
└── AI 置信度：0.0 - 1.0（决定是否需要人工审核）
```

#### 分类准确率预期

基于 OpenClaw 邮件 triage 场景的社区反馈 [5] 类比推算：

| 分类维度 | 预期准确率 | 说明 |
|---------|----------|------|
| 紧急程度 | 85-90% | 关键词匹配 + 上下文理解 |
| 消息类型 | 80-85% | 需要理解语义意图 |
| 需要回复判断 | 90-95% | 明确的 @mention + 问句模式 |
| 草拟回复质量 | 70-80% | 需人工审核调整 |

> **注意：** 上述准确率为基于邮件场景类比推算的预期值。中文消息的语义理解准确率可能略低于英文场景，实际效果需部署后验证。

### 审核工作流的可行性

#### 现状：OpenClaw 没有内置消息审核队列

OpenClaw 的 approvals 系统 [6] 是针对 `exec` 权限的安全控制机制——当 Agent 需要执行 Shell 命令或文件操作时请求用户批准。这不是通用的消息审核/审批队列。

#### 审核方案对比

| 方案 | 技术复杂度 | 用户体验 | 推荐度 |
|------|----------|---------|-------|
| A. 飞书消息卡片确认 | 低 | 中（在飞书内操作） | 适合简单场景 |
| B. Bitable 审核看板 | 中 | 高（可视化、可批量操作） | **推荐** |
| C. 自建 Web UI | 高 | 极高（完全定制） | 过度工程化 |
| D. 飞书 Bot 对话式审核 | 低 | 低（逐条确认，效率低） | 不推荐 |

**推荐方案 B 的理由：**

1. `@m1heng-clawd/feishu` 的 Bitable 工具已提供完整的表格 CRUD 能力 [2]，无需额外开发
2. 飞书多维表格本身支持视图切换（看板视图、表格视图）、筛选、排序、批量操作
3. 用户在飞书 App 内直接操作，无需切换应用
4. 天然支持多人协作，未来可扩展为团队审核流程

---

## 架构方案设计

### 推荐架构：收集-分类-审核三阶段模式

```
                           ┌──────────────────────────────────────────────────────┐
                           │                   飞书开放平台                         │
                           │                                                      │
  ┌──────────┐             │  ┌─────────────┐  ┌──────────────┐  ┌────────────┐  │
  │ 发送者 A  │──私信 Bot──>│  │ Bot 私聊    │  │ 群聊 @Bot    │  │ 群聊 @你   │  │
  │ 发送者 B  │──群里 @Bot─>│  │ 消息事件    │  │ 消息事件     │  │ (自动化    │  │
  │ 发送者 C  │──群里 @你──>│  │             │  │              │  │  转发到Bot) │  │
  └──────────┘             │  └──────┬──────┘  └──────┬───────┘  └─────┬──────┘  │
                           │         │                │                │         │
                           └─────────┼────────────────┼────────────────┼─────────┘
                                     │                │                │
                                     ▼                ▼                ▼
                           ┌──────────────────────────────────────────────────────┐
                           │        阶段一：消息收集层（Message Collector）          │
                           │                                                      │
                           │  @openclaw/feishu 插件 (WebSocket 长连接)              │
                           │  • 接收所有发给 Bot 的消息                              │
                           │  • 统一消息格式（sender, content, source, timestamp）    │
                           │  • 消息去重与缓存                                      │
                           └────────────────────────┬─────────────────────────────┘
                                                    │
                                                    ▼
                           ┌──────────────────────────────────────────────────────┐
                           │        阶段二：AI 分类层（Triage Agent）               │
                           │                                                      │
                           │  OpenClaw Agent (Claude Sonnet 4)                     │
                           │  • AGENTS.md 定义分类规则                               │
                           │  • 输出：紧急度 / 类型 / 主题 / 是否需回复 / 置信度       │
                           │  • 高置信度(>=0.8) → 自动处理                           │
                           │  • 中置信度(0.5-0.8) → 待审核                          │
                           │  • 低置信度(<0.5) → 需手动分类                          │
                           └──────────┬──────────────────────────┬────────────────┘
                                      │                          │
                                      ▼                          ▼
                  ┌────────────────────────────────┐  ┌────────────────────────────┐
                  │  阶段三：Bitable 审核看板         │  │     通知推送层                │
                  │  (飞书多维表格)                   │  │                             │
                  │                                │  │  • P0 紧急 → 即时通知         │
                  │  • 所有消息的分类结果              │  │  • 定时汇总 → Cron 推送       │
                  │  • 看板视图：待审核 / 已确认 /     │  │  • 低置信度 → 提醒人工介入     │
                  │    已处理 / 已忽略                │  │                             │
                  │  • 支持批量操作                   │  └────────────────────────────┘
                  │  • AI 建议的回复草稿              │
                  └────────────┬───────────────────┘
                               │
                               ▼
                  ┌────────────────────────────────┐
                  │      自动执行层                   │
                  │                                │
                  │  • 审核通过 → Reply Agent 发回复  │
                  │  • 自动归档已处理消息              │
                  │  • 定时清理历史记录               │
                  └────────────────────────────────┘
```

### 消息规范化结构

所有来源的消息统一为以下格式后进入 AI 分类层：

```json
{
  "id": "msg_xxxxxx",
  "source": "feishu_group",
  "group_name": "项目 Alpha 工作群",
  "sender": {
    "user_id": "ou_xxxxxx",
    "name": "张三",
    "department": "产品部"
  },
  "content": "@李四 请帮忙看一下这个需求文档，周三前给反馈",
  "mentions": ["ou_yyyyyy"],
  "timestamp": "2026-02-11T10:30:00+08:00",
  "message_type": "text",
  "is_at_me": true
}
```

### AI 分类 Agent 配置

**AGENTS.md 示例：**

```markdown
# Triage Agent - 飞书消息分类助手

## 角色定义
你是一个专业的消息分类助手，负责对收到的飞书消息进行智能分类和优先级排序。

## 分类规则

### 紧急度判断标准
- **P0 紧急**：包含"紧急""ASAP""立即""马上""今天必须"等关键词；来自直属上级或 VIP 联系人；明确的截止时间在 24 小时内；生产事故、客户投诉
- **P1 重要**：明确的任务请求且有截止时间；需要做决策或审批的事项；来自重要合作方
- **P2 普通**：一般性的工作讨论；信息同步类消息；截止时间在一周以上
- **P3 低优先级**：FYI 类消息；闲聊；群公告中不直接相关的内容；系统通知

### 类型判断标准
- **任务请求**：消息中包含明确的行动要求（"请帮忙""能否""需要你"）
- **信息通知**：单向信息传递，不需要回复（"通知""FYI""周知"）
- **问题咨询**：向你提问或征求意见（"怎么看""什么时候""如何"）
- **讨论参与**：邀请参与讨论（"大家讨论一下""有什么想法"）
- **审批事项**：需要审批或确认的流程（"请审批""请确认"）
- **闲聊**：非工作相关的社交性消息

## 输出格式
对每条消息输出以下 JSON：

```json
{
  "urgency": "P0|P1|P2|P3",
  "type": "任务请求|信息通知|问题咨询|讨论参与|审批事项|闲聊",
  "topic": "推断的主题/项目名",
  "needs_reply": true|false,
  "suggested_action": "简要建议",
  "draft_reply": "如 needs_reply 为 true，提供回复草稿",
  "confidence": 0.0-1.0,
  "summary": "一句话摘要"
}
```

## 特殊规则
1. VIP 联系人的消息紧急度至少为 P1
2. confidence < 0.5 时在 suggested_action 中注明"建议人工复核"
3. 纯表情/贴纸标记为"闲聊"，confidence 设为 1.0
4. 含文件/图片附件在 summary 中注明"[含附件]"
5. 来自[老板姓名]的消息自动升级一个优先级
6. 重复内容（群消息轰炸）合并为一条记录
```

**分类标准示例：**

| 消息示例 | 紧急度 | 类型 | 置信度 |
|---------|--------|------|--------|
| "@你 线上出 bug 了，紧急修复" | P0 | 任务请求 | 0.95 |
| "@你 请帮忙审批一下这个采购单" | P1 | 审批事项 | 0.90 |
| "@你 下周方案讨论会，你什么时候有空" | P2 | 问题咨询 | 0.85 |
| "@你 FYI 新版设计稿已上传到云盘" | P3 | 信息通知 | 0.92 |
| "@你 周末聚餐去不去" | P3 | 闲聊 | 0.88 |
| "@你 这个需求变更你怎么看" | P2 | 讨论参与 | 0.70 |
| "@你 [一张截图]" | P2 | 未知 | 0.35 |

### Bitable 审核看板设计

#### 主表结构

| 字段名 | 字段类型 | 说明 | 示例值 |
|--------|---------|------|--------|
| 消息ID | 文本 | 飞书消息唯一标识 | msg_abc123 |
| 收到时间 | 日期时间 | 消息接收时间 | 2026-02-11 10:30 |
| 发送者 | 文本 | 发送者姓名 | 张三 |
| 发送者部门 | 文本 | 发送者所属部门 | 产品部 |
| 来源 | 单选 | 私聊 / 群聊名称 | 项目 Alpha 工作群 |
| 原始内容 | 多行文本 | 消息原文 | @你 请帮忙看一下需求文档... |
| 优先级 | 单选 | P0 紧急 / P1 重要 / P2 普通 / P3 低 | P1 |
| 消息类型 | 单选 | 任务请求 / 问题咨询 / 会议通知 / 审批事项 / 信息同步 / 讨论参与 / 闲聊 / 其他 | 任务请求 |
| 主题 | 单选 | 所属项目/主题 | 项目 Alpha |
| AI 摘要 | 文本 | AI 生成的一句话摘要 | 张三请求在周三前确认需求方案 |
| 需要回复 | 复选框 | 是否需要回复 | true |
| 建议操作 | 文本 | AI 建议的处理方式 | 需要在周三前回复确认方案 |
| AI 回复草稿 | 多行文本 | AI 草拟的回复内容 | 好的，我会在周二晚上前审阅... |
| AI 置信度 | 数字 | 0.0-1.0 | 0.85 |
| 审核状态 | 单选 | 待审核 / 已确认 / 已处理 / 已忽略 / 需手动分类 | 待审核 |
| 实际回复 | 多行文本 | 修改后的最终回复 | （空） |
| 处理时间 | 日期时间 | 审核/处理完成时间 | 2026-02-11 11:00 |
| 自动处理 | 复选框 | 是否由 AI 自动处理 | false |

#### 辅助表：VIP 联系人

| 字段名 | 字段类型 | 说明 |
|--------|---------|------|
| 用户 ID | 文本 | 飞书 user_id |
| 姓名 | 文本 | 联系人姓名 |
| 角色 | 单选 | 上级/客户/同事/... |
| 默认紧急度 | 单选 | 该联系人消息的最低紧急度 |

#### 辅助表：分类规则

| 字段名 | 字段类型 | 说明 |
|--------|---------|------|
| 规则名 | 文本 | 规则标识 |
| 匹配条件 | 文本 | 触发条件描述 |
| 自动动作 | 单选 | 自动确认/自动忽略/升级 |
| 优先级 | 数字 | 规则执行优先级 |

#### 看板视图设计

```
┌───────────────┬───────────────┬───────────────┬───────────────┐
│   需手动分类    │    待审核      │    已确认      │    已处理      │
│   (AI 不确定)  │  (AI 已分类)   │  (你已确认)    │  (已执行动作)   │
├───────────────┼───────────────┼───────────────┼───────────────┤
│ [P?] 张三      │ [P0] 王总     │ [P1] 李总     │ [P2] 赵六     │
│   发了一张截图  │   线上 bug     │   采购审批     │   方案确认     │
│   置信度: 0.35 │   紧急修复     │               │   已回复       │
│               │               │               │               │
│               │ [P1] 张三     │ [P2] 钱七     │ [P3] 孙八     │
│               │   需求确认     │   会议时间     │   FYI 通知     │
│               │   周三截止     │               │   已读         │
└───────────────┴───────────────┴───────────────┴───────────────┘
```

建议创建四个视图：
1. **审核看板**（主工作视图）：按审核状态分列，拖拽改变状态
2. **紧急视图**：仅显示 P0 和 P1 消息，按收到时间排序
3. **待回复视图**：仅显示"需要回复 = true"且未处理的消息，含 AI 回复草稿
4. **统计仪表盘**：今日消息总数、各紧急度分布、AI 自动处理率、待审核积压数量

### 审核流程详细设计

```
消息进入
    │
    ▼
AI 分类（输出置信度）
    │
    ├── 置信度 >= 0.8 ──> 自动写入 Bitable，状态 = "已确认"
    │                      │
    │                      ├── 紧急度 P0 ──> 立即通知用户（飞书 Bot 消息）
    │                      └── 其他 ──> 等待下次定时汇总
    │
    ├── 0.5 <= 置信度 < 0.8 ──> 写入 Bitable，状态 = "待审核"
    │                              │
    │                              └── 等待用户在 Bitable 中确认或修改分类
    │
    └── 置信度 < 0.5 ──> 写入 Bitable，状态 = "需手动分类"
                           │
                           └── 立即通知用户："有一条消息 AI 无法分类，请手动处理"
```

**用户审核操作**：

1. **快速确认**：查看 AI 分类结果，正确则将状态改为"已确认"
2. **修改分类**：AI 分类不准确时手动修改紧急度/类型/主题，然后确认
3. **批量操作**：选中多条消息，批量标记为"已确认"或"已忽略"
4. **使用 AI 草稿回复**：AI 回复草稿合适则一键发送（或编辑后发送）

### 自动处理与人工干预的边界

| 场景 | AI 自动处理 | 人工干预 |
|------|-----------|---------|
| 高置信度分类（>0.8） | 自动写入 Bitable 并标记"已确认" | 用户可事后复查修改 |
| P3 闲聊类消息 | 自动标记"已忽略" | 用户可取消忽略 |
| 重复/相似消息 | 自动合并，只保留最新 | - |
| AI 回复草稿 | **不自动发送**，仅生成草稿 | 用户确认后发送 |
| VIP 联系人消息 | 自动提升紧急度 | 用户确认后处理 |
| 低置信度消息（<0.5） | 仅写入 Bitable | 用户必须手动分类 |
| 涉及金额/合同的消息 | 仅标记紧急 | 用户必须亲自处理 |
| 审批类消息 | 仅通知 | 用户必须亲自审批 |

**核心原则**：AI 的自动处理权限严格限于"分类"和"通知"层面。任何涉及"代替用户回复""代替用户执行操作"的行为，都需要人工确认后才执行。

### 三种架构方案对比

| 维度 | 简化版：Bot 直接响应 | 推荐版：三阶段模式 | 高级版：完整 Bitable 看板 |
|------|:---:|:---:|:---:|
| 实现复杂度 | 低（1-2 天） | 中（1-2 周） | 高（2-4 周） |
| 审核控制 | 无 | 有（逐条/批量） | 有（完整看板 + 多人协作） |
| 错误容忍度 | 低（直接回复） | 高（审核后回复） | 高（审核后回复） |
| 消息归档 | 无 | 有（Bitable 记录） | 有（完整历史 + 统计） |
| 团队协作 | 不支持 | 基础支持 | 完整支持 |
| 月成本 | $10-20 | $20-50 | $30-80 |
| 推荐场景 | 快速验证 | **个人生产使用** | 团队协作 |

---

## 实现路径

### 第一期：基础消息收集与分类（1 周）

**目标**：Bot 能接收消息并进行基础分类，结果写入 Bitable。

**步骤：**

1. **飞书开放平台配置**（30 分钟 - 2 小时）
   - 创建企业自建应用，开启 Bot 能力
   - 申请权限：`im:message.p2p_msg:readonly`、`im:message.group_at_msg:readonly`、`bitable:app`
   - 获取 App ID 和 App Secret
   - 配置事件订阅 `im.message.receive_v1`，选择 WebSocket 模式
   - （可选）同步提交 `im:message.group_msg` 敏感权限申请——审批需要时间，越早提交越好

2. **OpenClaw 飞书插件配置**（15 分钟 - 1 小时）

   ```bash
   # 确认 OpenClaw 版本 >= 2026.2
   openclaw --version

   # 安装官方飞书插件（如未内置）
   openclaw plugins install @openclaw/feishu

   # 安装 Bitable 操作插件
   openclaw plugins install @m1heng-clawd/feishu

   # 交互式配置飞书渠道
   openclaw channels add
   # 选择 feishu -> 输入 App ID -> 输入 App Secret
   ```

3. **config.yaml 配置**

   ```yaml
   ai:
     provider: "anthropic"
     model: "claude-sonnet-4-20250514"
     fallback_model: "claude-haiku-20250307"

   channels:
     feishu:
       app_id: "cli_xxxxxxxxxxxx"
       app_secret: "${FEISHU_APP_SECRET}"
       features:
         streaming: true
         group_chat: true
         mention_only: true    # 第一期仅 @Bot 时响应
         media:
           image: true
           file: true

   plugins:
     - name: "@m1heng-clawd/feishu"
       config:
         tools:
           bitable: true

   gateway:
     bind: "127.0.0.1"
     port: 18789
   ```

4. **配置 Triage Agent**（1-2 小时）
   - 编写 AGENTS.md 分类规则（参见架构方案设计章节）
   - 定义分类规则和 JSON 输出格式
   - 设置 VIP 联系人列表

5. **搭建 Bitable 审核看板**（1 小时）
   - 在飞书中创建多维表格
   - 按主表结构创建字段
   - 创建看板视图
   - 记录 `app_token` 和 `table_id`

6. **基础验证**（2 小时）
   - 在飞书中给 Bot 发送测试消息
   - 验证消息接收、分类、Bitable 写入是否正常
   - 在 2-3 个工作群中试运行
   - 调优分类规则

**第一期交付物**：Bot 可接收私聊和 @mention 消息，AI 自动分类后写入 Bitable 审核看板。

### 第二期：智能分类优化 + 定时汇总 + 审核流（1 周）

**目标**：分类准确率达标，配置审核后自动执行和定时汇总。

**步骤：**

1. **根据第一期反馈优化 AGENTS.md**（持续）
   - 分析分类错误案例，补充 System Prompt 的判断规则
   - 添加行业术语、缩写词汇表
   - 调整 VIP 联系人规则

2. **配置 P0 紧急推送**（2 小时）
   - P0 消息通过飞书卡片立即推送
   - 卡片包含消息摘要和快捷操作按钮

3. **配置定时汇总 Cron Jobs**（1-2 小时）

   ```yaml
   cron:
     jobs:
       - name: "morning_triage_summary"
         schedule: "0 9 * * 1-5"        # 工作日早上 9 点
         command: |
           查询 Bitable 中昨晚至今早的新消息，生成摘要：
           1. 总览：新消息 X 条
           2. 紧急待处理：列出 P0/P1 消息
           3. 待审核：X 条需要你确认
           4. 已自动处理：X 条
           通过飞书 Bot 发送给我。

       - name: "periodic_check"
         schedule: "0 */2 * * 1-5"      # 工作日每 2 小时
         command: |
           检查 Bitable 中状态为"待审核"的记录：
           - 如果有 P0/P1 待审核项，立即推送提醒
           - 如果待审核总数超过 10 条，推送汇总提醒
           - 如果没有新消息，不发送

       - name: "weekly_report"
         schedule: "0 18 * * 5"         # 每周五下午 6 点
         command: |
           生成本周消息处理统计报告：
           总消息数、各紧急度分布、各类型分布、
           AI 自动处理率、平均置信度趋势、需优化的分类规则建议。
   ```

4. **配置场景 B**（2-4 小时）
   - 尝试飞书自动化转发规则（场景 B-2）
   - 如 sensitive 权限已审批通过，配置全量消息监听（场景 B-1）

5. **逐步调低置信度阈值**
   - 初期阈值设为 0.9（保守），观察一段时间后逐步降低到 0.8

**第二期交付物**：完整的收集-分类-审核链路，配置定时汇总和紧急推送。

### 第三期：自动回复 + 异常处理 + 长期优化（1-2 周）

**目标**：审核后自动执行回复，处理边缘情况，建立持续优化机制。

**步骤：**

1. **配置 Reply Agent**（3 小时）

   ```yaml
   agents:
     triage-reply:
       model: "claude-haiku-20250307"     # 简单回复用 Haiku 节省成本
       description: "回复执行 Agent"
       skills: ["feishu-reply"]
   ```

   - 审核通过后自动发送飞书回复
   - 支持"修改后回复"（用户在 Bitable 中修改草拟内容）
   - 发送后更新记录状态为"已处理"

2. **异常升级机制**（2 小时）
   - AI 置信度低的消息标记为"需手动分类"
   - 超过 4 小时未审核的 P0/P1 消息自动升级提醒
   - 涉及金额/合同的消息始终标记为需人工处理

3. **成本优化**（2 小时）
   - P3 消息用 Haiku 模型处理（$0.25/MTok）
   - P0/P1 消息用 Sonnet 模型处理（$3/MTok）
   - 批量合并相似消息减少 API 调用
   - 群聊消息先用正则预过滤再送入 AI
   - 设置 Anthropic Console 月度预算上限 $50

4. **持续优化机制**（持续）
   - 记录每次人工修正的分类结果，定期将修正案例加入 AGENTS.md
   - 利用 OpenClaw 持久记忆记录用户偏好
   - 建立月度分类准确率审计
   - 添加发送者白名单/黑名单

**第三期交付物**：完整的自动化消息处理系统，包含自动回复、异常升级和成本控制。

---

## 风险与局限

### 技术风险

| 风险 | 影响 | 概率 | 缓解措施 |
|------|------|------|---------|
| `im:message.group_msg` 敏感权限审批被拒 | 无法收集群聊中 @人类用户的消息 | 中 | 改用飞书自动化转发方案（B-2）；或引导用户 @Bot |
| AI 分类准确率不达预期 | 大量消息需要人工重新分类 | 中 | 初期设置高阈值（0.9）；VIP 联系人规则兜底；密集审核前两周所有分类结果 |
| AI 草拟回复不当 | 审核后回复仍可能有措辞问题 | 低-中 | 严格禁止自动发送回复，所有回复仅生成草稿 |
| WebSocket 连接断线 | 消息丢失 | 低 | OpenClaw 官方插件内置重连逻辑 [1]；配置 Heartbeat 定期检查连接状态 |
| Bitable API 调用频率限制 | 高峰期写入失败 | 低 | 实现写入队列和重试机制；飞书 Bitable API 限制为 100 次/秒，个人使用绑绑有余 |
| 消息量暴增（被拉入大群） | API 成本飙升 | 中 | 配置消息过滤规则；设置 API 预算上限；群聊消息先正则预过滤 |
| OpenClaw Cron Job 不稳定 | 定时汇总缺失 | 中 | 已知 Cron Job 在 2026.2.4 之前有 bug [9]，需更新到最新版本；配置 Heartbeat 作为备用检查机制 |

### 功能局限

| 局限 | 说明 | 影响程度 |
|------|------|---------|
| **无法完全被动收集私聊** | Bot 无法读取人类用户之间的私聊，这是飞书平台安全设计 | 高——必须接受某种程度的行为改变 |
| **群聊上下文受限** | 不申请全量消息权限时，Bot 只能看到 @它 的消息，缺少前后文上下文 | 高——可能导致分类和回复质量下降 |
| **图片/语音消息处理受限** | 图片可通过 Claude 多模态理解但成本高，语音消息无法直接处理 | 中——建议对图片/语音仅做基础标记 |
| **无原生审核队列 UI** | OpenClaw 不提供消息审核界面 [6] | 中——Bitable 是合理替代方案 |
| **多语言/方言支持** | 混合中英文或行业术语/缩写可能导致误分类 | 中——需在 AGENTS.md 中补充行业词汇表 |
| **实时性延迟** | 从消息收集到写入 Bitable 有 1-3 秒延迟 | 低——对审核场景完全可接受 |
| **不支持离线场景** | OpenClaw 需持续运行，断电/重启期间消息会丢失 | 中——使用 Docker + 自动重启策略 |

### 安全风险

| 风险 | 缓解措施 |
|------|---------|
| Bot 接收的消息包含敏感信息，AI API 会将内容发送到 Anthropic 服务器 | 告知团队不要给 Bot 发送机密信息；考虑本地 LLM 方案 |
| API Key 泄露（飞书 App Secret + Anthropic API Key） | 使用环境变量管理密钥；不提交到 Git；定期轮换 |
| Prompt Injection 攻击 | 严格定义 Agent 权限边界；不授予 exec 权限；对消息内容进行基本清洗 |
| OpenClaw 管理面板暴露 | Gateway 仅监听 127.0.0.1；使用 Tailscale 进行远程访问；Docker 部署 [10] |
| 飞书消息含敏感信息被写入 Bitable | Bitable 审核看板设置访问权限；定期清理历史记录 |

---

## 建议

### 立即行动（本周）

1. **在飞书开放平台创建自建应用**，申请基础权限（`im:message.p2p_msg:readonly` + `im:message.group_at_msg:readonly` + `bitable:app`），同时提交 `im:message.group_msg` 敏感权限申请。

2. **安装 OpenClaw 飞书插件并完成基础验证**，确认 Bot 能正常接收消息。使用简化版（Bot 直接响应）做快速验证。

3. **搭建 Bitable 审核看板**，按本报告中的表结构创建字段和视图。

### 短期（第 2-3 周）

4. **按推荐版三阶段架构部署**，配置 Triage Agent + Cron Jobs + 审核流程。

5. **在 2-3 个工作群中试运行**，密集审核所有分类结果，根据错误案例优化 AGENTS.md。

6. **配置场景 B 的消息收集**——优先尝试飞书自动化转发（B-2），如 sensitive 权限已审批则配置全量监听（B-1）。

### 中期（第 4 周起）

7. **逐步扩展到所有工作群**，调低置信度阈值（从 0.9 -> 0.8），添加 Reply Agent。

8. **建立持续优化机制**——月度分类准确率审计，持久记忆学习用户偏好。

9. **评估是否需要升级到高级版**（完整 Bitable 看板 + 多人协作），取决于消息量和团队需求。

### 关键决策点

| 决策 | 选项 | 推荐 |
|------|------|------|
| 场景 B 实现方式 | B-1 全量监听 vs B-2 飞书自动化转发 | **B-2 优先**（低权限、低成本） |
| AI 模型选择 | Sonnet vs Opus vs Haiku | **Sonnet 为主**，Haiku 做汇总和简单回复 |
| 审核看板 | Bitable vs 飞书 Bot 交互 vs 第三方工具 | **Bitable**（原生集成、看板视图） |
| 部署方式 | 本地 vs Docker vs 云服务器 | **Docker 本地**（安全 + 免服务器成本） |
| 回复发送 | 自动发送 vs 仅生成草稿 | **仅生成草稿**（避免 AI 失控风险） |

### 成本预估

| 使用强度 | 日均消息量 | 月均 API 成本 | 推荐模型组合 |
|---------|----------|-------------|------------|
| 轻度 | 20-50 条 | $10-25 | Sonnet（分类）+ Haiku（汇总/回复） |
| 中度 | 50-200 条 | $25-50 | Sonnet（分类+回复） |
| 重度 | 200+ 条 | $50-100 | Sonnet（核心）+ Haiku（P3 消息）+ 正则预过滤 |

与人工处理对比：

| 维度 | AI 自动 Triage | 人工处理 |
|------|---------------|---------|
| 每日耗时 | 10-15 分钟审核 | 1-2 小时逐条处理 |
| 响应速度 | 即时分类 | 取决于查看时间 |
| 遗漏风险 | 低（全量处理） | 中-高（可能漏看） |
| 月成本 | $15-72 | 时间成本（按 $50/h 计，约 $1,000-2,000） |
| 扩展性 | 消息量增长不影响体验 | 线性增长 |

### 长期演进方向

1. **自学习分类模型**：记录人工修正历史，持续将修正案例加入 AGENTS.md 示例
2. **跨平台消息 Triage**：扩展到微信、邮件等其他渠道，实现统一消息分类看板
3. **自动回复能力**：当分类准确率稳定在 95%+ 后，对低风险消息（闲聊、FYI）开放 AI 自动回复
4. **团队共享 Triage**：将 Bitable 看板共享给助理/秘书，实现协作式消息处理
5. **飞书 Workflow 深度集成**：将审批类消息自动对接飞书审批流，实现端到端自动化

---

## 附录 A：证据表

| 编号 | 来源类型 | 标题/描述 | 质量 | 关键数据点 |
|------|---------|-----------|------|-----------|
| [1] | 官方文档 | OpenClaw Feishu Channel 文档 | A | 官方插件功能、WebSocket 模式、config.yaml 配置 |
| [2] | GitHub 仓库 | m1heng/clawdbot-feishu（2,947 星） | A | Bitable 多维表格 6 个操作工具（v0.1.7+）、飞书文档/Wiki/Drive 集成 |
| [3] | 官方文档 | 飞书开放平台 - 事件订阅 API | A | `im.message.receive_v1` 事件、`im:message.p2p_msg:readonly` / `im:message.group_at_msg:readonly` / `im:message.group_msg` 权限体系 |
| [4] | 官方文档 | 飞书开放平台 - Bot 能力文档 | A | Bot 消息接收范围、安全模型设计（Bot 与人类用户独立实体） |
| [5] | 视频/社区 | OpenClaw Email Triage 场景验证 | B | 邮件 triage 批量分类数百封邮件节省 4 小时；Gmail Rollup 每日汇总；Inbox Cleanup 技能 |
| [6] | 官方文档 | OpenClaw Approvals System | A | approvals 系统针对 exec 权限控制，非消息审核队列 |
| [7] | 调研报告 | OpenClaw 与 Lark 集成调研报告 (v3) | A | 官方插件功能矩阵、社区插件对比、部署路径选择 |
| [8] | 官方文档 | OpenClaw Core Features 文档 | A | Cron Jobs、Heartbeat、Multi-Agent Routing、Skills 系统、Lobster 工作流引擎、持久记忆 |
| [9] | 社区资讯 | OpenClaw Cron Job 稳定性问题 | B | v2026.2.4 修复了 Cron Job 触发 bug（#9788、#9733、#10025） |
| [10] | 安全研究 | Cisco / Noma Security 安全报告 | A | 1,100+ OpenClaw 暴露实例、Gateway 安全最佳实践 |

### 证据质量说明

- **A 级（官方权威）**：OpenClaw 官方文档、飞书开放平台官方文档、官方 GitHub 仓库
- **B 级（高质量社区）**：高星标开源项目、YouTube 实操演示、知名技术平台教程
- **C 级（参考补充）**：个人博客、社区讨论帖

## 附录 B：参考源

1. OpenClaw 官方飞书文档 — https://docs.openclaw.ai/zh-CN/channels/feishu
2. m1heng/clawdbot-feishu — https://github.com/m1heng/clawdbot-feishu
3. 飞书开放平台事件订阅文档 — https://open.feishu.cn/document/server-docs/im-v1/message/events/receive
4. 飞书开放平台 Bot 能力文档 — https://open.feishu.cn/document/home/develop-a-bot
5. VelvetShark YouTube 评测 — https://www.youtube.com/watch?v=52kOmSQGt_E
6. OpenClaw 官方文档 — https://docs.openclaw.ai
7. OpenClaw 与 Lark 集成调研报告 — 本仓库 research/openclaw/openclaw_lark_integration_report.md
8. OpenClaw 核心功能文档 — https://docs.openclaw.ai/features
9. OpenClaw Cron Job 修复公告 — https://github.com/openclaw/openclaw/issues/9788
10. Cisco AI 安全博客 — https://blogs.cisco.com/ai/personal-ai-agents-like-openclaw-are-a-security-nightmare

## 附录 C：术语表

| 术语 | 说明 |
|------|------|
| **Triage** | 分拣/分流，源自医疗急救的伤情分类概念，在本报告中指消息的自动分类和优先级排序 |
| **Bitable** | 飞书多维表格，类似 Airtable 的数据库+表格+看板工具 |
| **Cron Job** | 基于 cron 表达式的定时任务调度 |
| **Heartbeat** | 心跳机制，OpenClaw 的周期性主动检查和推送系统 |
| **Multi-Agent Routing** | 多代理路由，将不同类型的请求分配给不同的 AI Agent 处理 |
| **WebSocket** | 全双工通信协议，支持客户端和服务端之间的持久连接 |
| **System Prompt** | 系统提示词，定义 AI Agent 的角色、规则和行为边界 |
| **Prompt Injection** | 提示注入攻击，通过恶意输入操纵 AI Agent 行为 |
| **Sensitive Permission** | 飞书开放平台的敏感权限，需要管理员人工审核才能获批 |
| **Lobster 工作流引擎** | OpenClaw 的复杂自动化管道编排系统 |
| **AGENTS.md** | OpenClaw 的 Agent 配置文件，定义 Agent 的角色、规则和工具 |

---

> **免责声明：** 本报告基于 2026 年 2 月 11 日可获取的公开信息撰写。OpenClaw 和飞书开放平台均处于快速迭代期，具体 API 能力和配置方式可能随版本更新而变化。报告中的 config.yaml 和 AGENTS.md 示例为示意性配置，实际部署时请以官方文档最新版本为准。分类准确率和成本估算基于类比推算和社区经验，实际效果因使用场景而异。
